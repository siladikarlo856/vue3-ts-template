{
  "version": 3,
  "sources": ["(disabled):crypto", "../../node_modules/crypto-js/core.js", "../../node_modules/crypto-js/sha256.js", "../../node_modules/crypto-js/enc-base64.js", "../../node_modules/crypto-js/enc-utf8.js", "../../src/index.ts", "../../src/utils/CryptoUtils.ts", "../../src/utils/Logger.ts", "../../src/utils/Event.ts", "../../node_modules/jwt-decode/lib/atob.js", "../../node_modules/jwt-decode/lib/base64_url_decode.js", "../../node_modules/jwt-decode/lib/index.js", "../../src/utils/JwtUtils.ts", "../../src/utils/PopupUtils.ts", "../../src/utils/Timer.ts", "../../src/utils/UrlUtils.ts", "../../src/errors/ErrorResponse.ts", "../../src/errors/ErrorTimeout.ts", "../../src/AccessTokenEvents.ts", "../../src/CheckSessionIFrame.ts", "../../src/InMemoryWebStorage.ts", "../../src/JsonService.ts", "../../src/MetadataService.ts", "../../src/WebStorageStateStore.ts", "../../src/OidcClientSettings.ts", "../../src/UserInfoService.ts", "../../src/TokenClient.ts", "../../src/ResponseValidator.ts", "../../src/State.ts", "../../src/SigninState.ts", "../../src/SigninRequest.ts", "../../src/SigninResponse.ts", "../../src/SignoutRequest.ts", "../../src/SignoutResponse.ts", "../../src/OidcClient.ts", "../../src/SessionMonitor.ts", "../../src/User.ts", "../../src/navigators/AbstractChildWindow.ts", "../../src/UserManagerSettings.ts", "../../src/navigators/IFrameWindow.ts", "../../src/navigators/IFrameNavigator.ts", "../../src/navigators/PopupWindow.ts", "../../src/navigators/PopupNavigator.ts", "../../src/navigators/RedirectNavigator.ts", "../../src/UserManagerEvents.ts", "../../src/SilentRenewService.ts", "../../src/RefreshState.ts", "../../src/UserManager.ts", "../../src/Version.ts"],
  "sourcesContent": ["", ";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory();\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\troot.CryptoJS = factory();\n\t}\n}(this, function () {\n\n\t/*globals window, global, require*/\n\n\t/**\n\t * CryptoJS core components.\n\t */\n\tvar CryptoJS = CryptoJS || (function (Math, undefined) {\n\n\t    var crypto;\n\n\t    // Native crypto from window (Browser)\n\t    if (typeof window !== 'undefined' && window.crypto) {\n\t        crypto = window.crypto;\n\t    }\n\n\t    // Native crypto in web worker (Browser)\n\t    if (typeof self !== 'undefined' && self.crypto) {\n\t        crypto = self.crypto;\n\t    }\n\n\t    // Native crypto from worker\n\t    if (typeof globalThis !== 'undefined' && globalThis.crypto) {\n\t        crypto = globalThis.crypto;\n\t    }\n\n\t    // Native (experimental IE 11) crypto from window (Browser)\n\t    if (!crypto && typeof window !== 'undefined' && window.msCrypto) {\n\t        crypto = window.msCrypto;\n\t    }\n\n\t    // Native crypto from global (NodeJS)\n\t    if (!crypto && typeof global !== 'undefined' && global.crypto) {\n\t        crypto = global.crypto;\n\t    }\n\n\t    // Native crypto import via require (NodeJS)\n\t    if (!crypto && typeof require === 'function') {\n\t        try {\n\t            crypto = require('crypto');\n\t        } catch (err) {}\n\t    }\n\n\t    /*\n\t     * Cryptographically secure pseudorandom number generator\n\t     *\n\t     * As Math.random() is cryptographically not safe to use\n\t     */\n\t    var cryptoSecureRandomInt = function () {\n\t        if (crypto) {\n\t            // Use getRandomValues method (Browser)\n\t            if (typeof crypto.getRandomValues === 'function') {\n\t                try {\n\t                    return crypto.getRandomValues(new Uint32Array(1))[0];\n\t                } catch (err) {}\n\t            }\n\n\t            // Use randomBytes method (NodeJS)\n\t            if (typeof crypto.randomBytes === 'function') {\n\t                try {\n\t                    return crypto.randomBytes(4).readInt32LE();\n\t                } catch (err) {}\n\t            }\n\t        }\n\n\t        throw new Error('Native crypto module could not be used to get secure random number.');\n\t    };\n\n\t    /*\n\t     * Local polyfill of Object.create\n\n\t     */\n\t    var create = Object.create || (function () {\n\t        function F() {}\n\n\t        return function (obj) {\n\t            var subtype;\n\n\t            F.prototype = obj;\n\n\t            subtype = new F();\n\n\t            F.prototype = null;\n\n\t            return subtype;\n\t        };\n\t    }());\n\n\t    /**\n\t     * CryptoJS namespace.\n\t     */\n\t    var C = {};\n\n\t    /**\n\t     * Library namespace.\n\t     */\n\t    var C_lib = C.lib = {};\n\n\t    /**\n\t     * Base object for prototypal inheritance.\n\t     */\n\t    var Base = C_lib.Base = (function () {\n\n\n\t        return {\n\t            /**\n\t             * Creates a new object that inherits from this object.\n\t             *\n\t             * @param {Object} overrides Properties to copy into the new object.\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         field: 'value',\n\t             *\n\t             *         method: function () {\n\t             *         }\n\t             *     });\n\t             */\n\t            extend: function (overrides) {\n\t                // Spawn\n\t                var subtype = create(this);\n\n\t                // Augment\n\t                if (overrides) {\n\t                    subtype.mixIn(overrides);\n\t                }\n\n\t                // Create default initializer\n\t                if (!subtype.hasOwnProperty('init') || this.init === subtype.init) {\n\t                    subtype.init = function () {\n\t                        subtype.$super.init.apply(this, arguments);\n\t                    };\n\t                }\n\n\t                // Initializer's prototype is the subtype object\n\t                subtype.init.prototype = subtype;\n\n\t                // Reference supertype\n\t                subtype.$super = this;\n\n\t                return subtype;\n\t            },\n\n\t            /**\n\t             * Extends this object and runs the init method.\n\t             * Arguments to create() will be passed to init().\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var instance = MyType.create();\n\t             */\n\t            create: function () {\n\t                var instance = this.extend();\n\t                instance.init.apply(instance, arguments);\n\n\t                return instance;\n\t            },\n\n\t            /**\n\t             * Initializes a newly created object.\n\t             * Override this method to add some logic when your objects are created.\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         init: function () {\n\t             *             // ...\n\t             *         }\n\t             *     });\n\t             */\n\t            init: function () {\n\t            },\n\n\t            /**\n\t             * Copies properties into this object.\n\t             *\n\t             * @param {Object} properties The properties to mix in.\n\t             *\n\t             * @example\n\t             *\n\t             *     MyType.mixIn({\n\t             *         field: 'value'\n\t             *     });\n\t             */\n\t            mixIn: function (properties) {\n\t                for (var propertyName in properties) {\n\t                    if (properties.hasOwnProperty(propertyName)) {\n\t                        this[propertyName] = properties[propertyName];\n\t                    }\n\t                }\n\n\t                // IE won't copy toString using the loop above\n\t                if (properties.hasOwnProperty('toString')) {\n\t                    this.toString = properties.toString;\n\t                }\n\t            },\n\n\t            /**\n\t             * Creates a copy of this object.\n\t             *\n\t             * @return {Object} The clone.\n\t             *\n\t             * @example\n\t             *\n\t             *     var clone = instance.clone();\n\t             */\n\t            clone: function () {\n\t                return this.init.prototype.extend(this);\n\t            }\n\t        };\n\t    }());\n\n\t    /**\n\t     * An array of 32-bit words.\n\t     *\n\t     * @property {Array} words The array of 32-bit words.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var WordArray = C_lib.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of 32-bit words.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.create();\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607]);\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607], 6);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 4;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this word array to a string.\n\t         *\n\t         * @param {Encoder} encoder (Optional) The encoding strategy to use. Default: CryptoJS.enc.Hex\n\t         *\n\t         * @return {string} The stringified word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var string = wordArray + '';\n\t         *     var string = wordArray.toString();\n\t         *     var string = wordArray.toString(CryptoJS.enc.Utf8);\n\t         */\n\t        toString: function (encoder) {\n\t            return (encoder || Hex).stringify(this);\n\t        },\n\n\t        /**\n\t         * Concatenates a word array to this word array.\n\t         *\n\t         * @param {WordArray} wordArray The word array to append.\n\t         *\n\t         * @return {WordArray} This word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray1.concat(wordArray2);\n\t         */\n\t        concat: function (wordArray) {\n\t            // Shortcuts\n\t            var thisWords = this.words;\n\t            var thatWords = wordArray.words;\n\t            var thisSigBytes = this.sigBytes;\n\t            var thatSigBytes = wordArray.sigBytes;\n\n\t            // Clamp excess bits\n\t            this.clamp();\n\n\t            // Concat\n\t            if (thisSigBytes % 4) {\n\t                // Copy one byte at a time\n\t                for (var i = 0; i < thatSigBytes; i++) {\n\t                    var thatByte = (thatWords[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                    thisWords[(thisSigBytes + i) >>> 2] |= thatByte << (24 - ((thisSigBytes + i) % 4) * 8);\n\t                }\n\t            } else {\n\t                // Copy one word at a time\n\t                for (var j = 0; j < thatSigBytes; j += 4) {\n\t                    thisWords[(thisSigBytes + j) >>> 2] = thatWords[j >>> 2];\n\t                }\n\t            }\n\t            this.sigBytes += thatSigBytes;\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Removes insignificant bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray.clamp();\n\t         */\n\t        clamp: function () {\n\t            // Shortcuts\n\t            var words = this.words;\n\t            var sigBytes = this.sigBytes;\n\n\t            // Clamp\n\t            words[sigBytes >>> 2] &= 0xffffffff << (32 - (sigBytes % 4) * 8);\n\t            words.length = Math.ceil(sigBytes / 4);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = wordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone.words = this.words.slice(0);\n\n\t            return clone;\n\t        },\n\n\t        /**\n\t         * Creates a word array filled with random bytes.\n\t         *\n\t         * @param {number} nBytes The number of random bytes to generate.\n\t         *\n\t         * @return {WordArray} The random word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.random(16);\n\t         */\n\t        random: function (nBytes) {\n\t            var words = [];\n\n\t            for (var i = 0; i < nBytes; i += 4) {\n\t                words.push(cryptoSecureRandomInt());\n\t            }\n\n\t            return new WordArray.init(words, nBytes);\n\t        }\n\t    });\n\n\t    /**\n\t     * Encoder namespace.\n\t     */\n\t    var C_enc = C.enc = {};\n\n\t    /**\n\t     * Hex encoding strategy.\n\t     */\n\t    var Hex = C_enc.Hex = {\n\t        /**\n\t         * Converts a word array to a hex string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The hex string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var hexString = CryptoJS.enc.Hex.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var hexChars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                hexChars.push((bite >>> 4).toString(16));\n\t                hexChars.push((bite & 0x0f).toString(16));\n\t            }\n\n\t            return hexChars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a hex string to a word array.\n\t         *\n\t         * @param {string} hexStr The hex string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Hex.parse(hexString);\n\t         */\n\t        parse: function (hexStr) {\n\t            // Shortcut\n\t            var hexStrLength = hexStr.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < hexStrLength; i += 2) {\n\t                words[i >>> 3] |= parseInt(hexStr.substr(i, 2), 16) << (24 - (i % 8) * 4);\n\t            }\n\n\t            return new WordArray.init(words, hexStrLength / 2);\n\t        }\n\t    };\n\n\t    /**\n\t     * Latin1 encoding strategy.\n\t     */\n\t    var Latin1 = C_enc.Latin1 = {\n\t        /**\n\t         * Converts a word array to a Latin1 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Latin1 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var latin1String = CryptoJS.enc.Latin1.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var latin1Chars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                latin1Chars.push(String.fromCharCode(bite));\n\t            }\n\n\t            return latin1Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Latin1 string to a word array.\n\t         *\n\t         * @param {string} latin1Str The Latin1 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Latin1.parse(latin1String);\n\t         */\n\t        parse: function (latin1Str) {\n\t            // Shortcut\n\t            var latin1StrLength = latin1Str.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < latin1StrLength; i++) {\n\t                words[i >>> 2] |= (latin1Str.charCodeAt(i) & 0xff) << (24 - (i % 4) * 8);\n\t            }\n\n\t            return new WordArray.init(words, latin1StrLength);\n\t        }\n\t    };\n\n\t    /**\n\t     * UTF-8 encoding strategy.\n\t     */\n\t    var Utf8 = C_enc.Utf8 = {\n\t        /**\n\t         * Converts a word array to a UTF-8 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The UTF-8 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var utf8String = CryptoJS.enc.Utf8.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            try {\n\t                return decodeURIComponent(escape(Latin1.stringify(wordArray)));\n\t            } catch (e) {\n\t                throw new Error('Malformed UTF-8 data');\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts a UTF-8 string to a word array.\n\t         *\n\t         * @param {string} utf8Str The UTF-8 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Utf8.parse(utf8String);\n\t         */\n\t        parse: function (utf8Str) {\n\t            return Latin1.parse(unescape(encodeURIComponent(utf8Str)));\n\t        }\n\t    };\n\n\t    /**\n\t     * Abstract buffered block algorithm template.\n\t     *\n\t     * The property blockSize must be implemented in a concrete subtype.\n\t     *\n\t     * @property {number} _minBufferSize The number of blocks that should be kept unprocessed in the buffer. Default: 0\n\t     */\n\t    var BufferedBlockAlgorithm = C_lib.BufferedBlockAlgorithm = Base.extend({\n\t        /**\n\t         * Resets this block algorithm's data buffer to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm.reset();\n\t         */\n\t        reset: function () {\n\t            // Initial values\n\t            this._data = new WordArray.init();\n\t            this._nDataBytes = 0;\n\t        },\n\n\t        /**\n\t         * Adds new data to this block algorithm's buffer.\n\t         *\n\t         * @param {WordArray|string} data The data to append. Strings are converted to a WordArray using UTF-8.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm._append('data');\n\t         *     bufferedBlockAlgorithm._append(wordArray);\n\t         */\n\t        _append: function (data) {\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof data == 'string') {\n\t                data = Utf8.parse(data);\n\t            }\n\n\t            // Append\n\t            this._data.concat(data);\n\t            this._nDataBytes += data.sigBytes;\n\t        },\n\n\t        /**\n\t         * Processes available data blocks.\n\t         *\n\t         * This method invokes _doProcessBlock(offset), which must be implemented by a concrete subtype.\n\t         *\n\t         * @param {boolean} doFlush Whether all blocks and partial blocks should be processed.\n\t         *\n\t         * @return {WordArray} The processed data.\n\t         *\n\t         * @example\n\t         *\n\t         *     var processedData = bufferedBlockAlgorithm._process();\n\t         *     var processedData = bufferedBlockAlgorithm._process(!!'flush');\n\t         */\n\t        _process: function (doFlush) {\n\t            var processedWords;\n\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\t            var dataSigBytes = data.sigBytes;\n\t            var blockSize = this.blockSize;\n\t            var blockSizeBytes = blockSize * 4;\n\n\t            // Count blocks ready\n\t            var nBlocksReady = dataSigBytes / blockSizeBytes;\n\t            if (doFlush) {\n\t                // Round up to include partial blocks\n\t                nBlocksReady = Math.ceil(nBlocksReady);\n\t            } else {\n\t                // Round down to include only full blocks,\n\t                // less the number of blocks that must remain in the buffer\n\t                nBlocksReady = Math.max((nBlocksReady | 0) - this._minBufferSize, 0);\n\t            }\n\n\t            // Count words ready\n\t            var nWordsReady = nBlocksReady * blockSize;\n\n\t            // Count bytes ready\n\t            var nBytesReady = Math.min(nWordsReady * 4, dataSigBytes);\n\n\t            // Process blocks\n\t            if (nWordsReady) {\n\t                for (var offset = 0; offset < nWordsReady; offset += blockSize) {\n\t                    // Perform concrete-algorithm logic\n\t                    this._doProcessBlock(dataWords, offset);\n\t                }\n\n\t                // Remove processed words\n\t                processedWords = dataWords.splice(0, nWordsReady);\n\t                data.sigBytes -= nBytesReady;\n\t            }\n\n\t            // Return processed words\n\t            return new WordArray.init(processedWords, nBytesReady);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this object.\n\t         *\n\t         * @return {Object} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = bufferedBlockAlgorithm.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone._data = this._data.clone();\n\n\t            return clone;\n\t        },\n\n\t        _minBufferSize: 0\n\t    });\n\n\t    /**\n\t     * Abstract hasher template.\n\t     *\n\t     * @property {number} blockSize The number of 32-bit words this hasher operates on. Default: 16 (512 bits)\n\t     */\n\t    var Hasher = C_lib.Hasher = BufferedBlockAlgorithm.extend({\n\t        /**\n\t         * Configuration options.\n\t         */\n\t        cfg: Base.extend(),\n\n\t        /**\n\t         * Initializes a newly created hasher.\n\t         *\n\t         * @param {Object} cfg (Optional) The configuration options to use for this hash computation.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hasher = CryptoJS.algo.SHA256.create();\n\t         */\n\t        init: function (cfg) {\n\t            // Apply config defaults\n\t            this.cfg = this.cfg.extend(cfg);\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this hasher to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Reset data buffer\n\t            BufferedBlockAlgorithm.reset.call(this);\n\n\t            // Perform concrete-hasher logic\n\t            this._doReset();\n\t        },\n\n\t        /**\n\t         * Updates this hasher with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {Hasher} This hasher.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.update('message');\n\t         *     hasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            // Append\n\t            this._append(messageUpdate);\n\n\t            // Update the hash\n\t            this._process();\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the hash computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The hash.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hash = hasher.finalize();\n\t         *     var hash = hasher.finalize('message');\n\t         *     var hash = hasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Final message update\n\t            if (messageUpdate) {\n\t                this._append(messageUpdate);\n\t            }\n\n\t            // Perform concrete-hasher logic\n\t            var hash = this._doFinalize();\n\n\t            return hash;\n\t        },\n\n\t        blockSize: 512/32,\n\n\t        /**\n\t         * Creates a shortcut function to a hasher's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to create a helper for.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var SHA256 = CryptoJS.lib.Hasher._createHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHelper: function (hasher) {\n\t            return function (message, cfg) {\n\t                return new hasher.init(cfg).finalize(message);\n\t            };\n\t        },\n\n\t        /**\n\t         * Creates a shortcut function to the HMAC's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to use in this HMAC helper.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var HmacSHA256 = CryptoJS.lib.Hasher._createHmacHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHmacHelper: function (hasher) {\n\t            return function (message, key) {\n\t                return new C_algo.HMAC.init(hasher, key).finalize(message);\n\t            };\n\t        }\n\t    });\n\n\t    /**\n\t     * Algorithm namespace.\n\t     */\n\t    var C_algo = C.algo = {};\n\n\t    return C;\n\t}(Math));\n\n\n\treturn CryptoJS;\n\n}));", ";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function (Math) {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_algo = C.algo;\n\n\t    // Initialization and round constants tables\n\t    var H = [];\n\t    var K = [];\n\n\t    // Compute constants\n\t    (function () {\n\t        function isPrime(n) {\n\t            var sqrtN = Math.sqrt(n);\n\t            for (var factor = 2; factor <= sqrtN; factor++) {\n\t                if (!(n % factor)) {\n\t                    return false;\n\t                }\n\t            }\n\n\t            return true;\n\t        }\n\n\t        function getFractionalBits(n) {\n\t            return ((n - (n | 0)) * 0x100000000) | 0;\n\t        }\n\n\t        var n = 2;\n\t        var nPrime = 0;\n\t        while (nPrime < 64) {\n\t            if (isPrime(n)) {\n\t                if (nPrime < 8) {\n\t                    H[nPrime] = getFractionalBits(Math.pow(n, 1 / 2));\n\t                }\n\t                K[nPrime] = getFractionalBits(Math.pow(n, 1 / 3));\n\n\t                nPrime++;\n\t            }\n\n\t            n++;\n\t        }\n\t    }());\n\n\t    // Reusable object\n\t    var W = [];\n\n\t    /**\n\t     * SHA-256 hash algorithm.\n\t     */\n\t    var SHA256 = C_algo.SHA256 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new WordArray.init(H.slice(0));\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcut\n\t            var H = this._hash.words;\n\n\t            // Working variables\n\t            var a = H[0];\n\t            var b = H[1];\n\t            var c = H[2];\n\t            var d = H[3];\n\t            var e = H[4];\n\t            var f = H[5];\n\t            var g = H[6];\n\t            var h = H[7];\n\n\t            // Computation\n\t            for (var i = 0; i < 64; i++) {\n\t                if (i < 16) {\n\t                    W[i] = M[offset + i] | 0;\n\t                } else {\n\t                    var gamma0x = W[i - 15];\n\t                    var gamma0  = ((gamma0x << 25) | (gamma0x >>> 7))  ^\n\t                                  ((gamma0x << 14) | (gamma0x >>> 18)) ^\n\t                                   (gamma0x >>> 3);\n\n\t                    var gamma1x = W[i - 2];\n\t                    var gamma1  = ((gamma1x << 15) | (gamma1x >>> 17)) ^\n\t                                  ((gamma1x << 13) | (gamma1x >>> 19)) ^\n\t                                   (gamma1x >>> 10);\n\n\t                    W[i] = gamma0 + W[i - 7] + gamma1 + W[i - 16];\n\t                }\n\n\t                var ch  = (e & f) ^ (~e & g);\n\t                var maj = (a & b) ^ (a & c) ^ (b & c);\n\n\t                var sigma0 = ((a << 30) | (a >>> 2)) ^ ((a << 19) | (a >>> 13)) ^ ((a << 10) | (a >>> 22));\n\t                var sigma1 = ((e << 26) | (e >>> 6)) ^ ((e << 21) | (e >>> 11)) ^ ((e << 7)  | (e >>> 25));\n\n\t                var t1 = h + sigma1 + ch + K[i] + W[i];\n\t                var t2 = sigma0 + maj;\n\n\t                h = g;\n\t                g = f;\n\t                f = e;\n\t                e = (d + t1) | 0;\n\t                d = c;\n\t                c = b;\n\t                b = a;\n\t                a = (t1 + t2) | 0;\n\t            }\n\n\t            // Intermediate hash value\n\t            H[0] = (H[0] + a) | 0;\n\t            H[1] = (H[1] + b) | 0;\n\t            H[2] = (H[2] + c) | 0;\n\t            H[3] = (H[3] + d) | 0;\n\t            H[4] = (H[4] + e) | 0;\n\t            H[5] = (H[5] + f) | 0;\n\t            H[6] = (H[6] + g) | 0;\n\t            H[7] = (H[7] + h) | 0;\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 14] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Return final computed hash\n\t            return this._hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        }\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA256('message');\n\t     *     var hash = CryptoJS.SHA256(wordArray);\n\t     */\n\t    C.SHA256 = Hasher._createHelper(SHA256);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA256(message, key);\n\t     */\n\t    C.HmacSHA256 = Hasher._createHmacHelper(SHA256);\n\t}(Math));\n\n\n\treturn CryptoJS.SHA256;\n\n}));", ";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var C_enc = C.enc;\n\n\t    /**\n\t     * Base64 encoding strategy.\n\t     */\n\t    var Base64 = C_enc.Base64 = {\n\t        /**\n\t         * Converts a word array to a Base64 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Base64 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var base64String = CryptoJS.enc.Base64.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\t            var map = this._map;\n\n\t            // Clamp excess bits\n\t            wordArray.clamp();\n\n\t            // Convert\n\t            var base64Chars = [];\n\t            for (var i = 0; i < sigBytes; i += 3) {\n\t                var byte1 = (words[i >>> 2]       >>> (24 - (i % 4) * 8))       & 0xff;\n\t                var byte2 = (words[(i + 1) >>> 2] >>> (24 - ((i + 1) % 4) * 8)) & 0xff;\n\t                var byte3 = (words[(i + 2) >>> 2] >>> (24 - ((i + 2) % 4) * 8)) & 0xff;\n\n\t                var triplet = (byte1 << 16) | (byte2 << 8) | byte3;\n\n\t                for (var j = 0; (j < 4) && (i + j * 0.75 < sigBytes); j++) {\n\t                    base64Chars.push(map.charAt((triplet >>> (6 * (3 - j))) & 0x3f));\n\t                }\n\t            }\n\n\t            // Add padding\n\t            var paddingChar = map.charAt(64);\n\t            if (paddingChar) {\n\t                while (base64Chars.length % 4) {\n\t                    base64Chars.push(paddingChar);\n\t                }\n\t            }\n\n\t            return base64Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Base64 string to a word array.\n\t         *\n\t         * @param {string} base64Str The Base64 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Base64.parse(base64String);\n\t         */\n\t        parse: function (base64Str) {\n\t            // Shortcuts\n\t            var base64StrLength = base64Str.length;\n\t            var map = this._map;\n\t            var reverseMap = this._reverseMap;\n\n\t            if (!reverseMap) {\n\t                    reverseMap = this._reverseMap = [];\n\t                    for (var j = 0; j < map.length; j++) {\n\t                        reverseMap[map.charCodeAt(j)] = j;\n\t                    }\n\t            }\n\n\t            // Ignore padding\n\t            var paddingChar = map.charAt(64);\n\t            if (paddingChar) {\n\t                var paddingIndex = base64Str.indexOf(paddingChar);\n\t                if (paddingIndex !== -1) {\n\t                    base64StrLength = paddingIndex;\n\t                }\n\t            }\n\n\t            // Convert\n\t            return parseLoop(base64Str, base64StrLength, reverseMap);\n\n\t        },\n\n\t        _map: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\n\t    };\n\n\t    function parseLoop(base64Str, base64StrLength, reverseMap) {\n\t      var words = [];\n\t      var nBytes = 0;\n\t      for (var i = 0; i < base64StrLength; i++) {\n\t          if (i % 4) {\n\t              var bits1 = reverseMap[base64Str.charCodeAt(i - 1)] << ((i % 4) * 2);\n\t              var bits2 = reverseMap[base64Str.charCodeAt(i)] >>> (6 - (i % 4) * 2);\n\t              var bitsCombined = bits1 | bits2;\n\t              words[nBytes >>> 2] |= bitsCombined << (24 - (nBytes % 4) * 8);\n\t              nBytes++;\n\t          }\n\t      }\n\t      return WordArray.create(words, nBytes);\n\t    }\n\t}());\n\n\n\treturn CryptoJS.enc.Base64;\n\n}));", ";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\treturn CryptoJS.enc.Utf8;\n\n}));", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nexport { ErrorResponse, ErrorTimeout } from \"./errors\";\r\nexport type { IFrameWindowParams, PopupWindowParams, RedirectParams } from \"./navigators\";\r\nexport { Log, Logger } from \"./utils\";\r\nexport type { ILogger, PopupWindowFeatures } from \"./utils\";\r\nexport type { OidcAddressClaim, OidcStandardClaims, IdTokenClaims, JwtClaims } from \"./Claims\";\r\n\r\nexport { AccessTokenEvents } from \"./AccessTokenEvents\";\r\nexport type { AccessTokenCallback } from \"./AccessTokenEvents\";\r\nexport { CheckSessionIFrame } from \"./CheckSessionIFrame\";\r\nexport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\r\nexport { MetadataService } from \"./MetadataService\";\r\nexport * from \"./OidcClient\";\r\nexport { OidcClientSettingsStore } from \"./OidcClientSettings\";\r\nexport type { OidcClientSettings, SigningKey } from \"./OidcClientSettings\";\r\nexport type { OidcMetadata } from \"./OidcMetadata\";\r\nexport { SessionMonitor } from \"./SessionMonitor\";\r\nexport type { SessionStatus } from \"./SessionStatus\";\r\nexport type { SigninRequest, SigninRequestArgs } from \"./SigninRequest\";\r\nexport { SigninResponse } from \"./SigninResponse\";\r\nexport { SigninState } from \"./SigninState\";\r\nexport type { SignoutRequest, SignoutRequestArgs } from \"./SignoutRequest\";\r\nexport { SignoutResponse } from \"./SignoutResponse\";\r\nexport { State } from \"./State\";\r\nexport type { StateStore } from \"./StateStore\";\r\nexport { User } from \"./User\";\r\nexport type { UserProfile } from \"./User\";\r\nexport * from \"./UserManager\";\r\nexport type {\r\n    UserManagerEvents,\r\n    SilentRenewErrorCallback,\r\n    UserLoadedCallback,\r\n    UserSessionChangedCallback,\r\n    UserSignedInCallback,\r\n    UserSignedOutCallback,\r\n    UserUnloadedCallback,\r\n} from \"./UserManagerEvents\";\r\nexport { UserManagerSettingsStore } from \"./UserManagerSettings\";\r\nexport type { UserManagerSettings } from \"./UserManagerSettings\";\r\nexport { Version } from \"./Version\";\r\nexport { WebStorageStateStore } from \"./WebStorageStateStore\";\r\n", "import CryptoJS from \"crypto-js/core.js\";\r\nimport sha256 from \"crypto-js/sha256.js\";\r\nimport Base64 from \"crypto-js/enc-base64.js\";\r\nimport Utf8 from \"crypto-js/enc-utf8.js\";\r\n\r\nimport { Logger } from \"./Logger\";\r\n\r\nconst UUID_V4_TEMPLATE = \"10000000-1000-4000-8000-100000000000\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class CryptoUtils {\r\n    private static _randomWord(): number {\r\n        return CryptoJS.lib.WordArray.random(1).words[0];\r\n    }\r\n\r\n    /**\r\n     * Generates RFC4122 version 4 guid\r\n     */\r\n    public static generateUUIDv4(): string {\r\n        const uuid = UUID_V4_TEMPLATE.replace(/[018]/g, c =>\r\n            (+c ^ CryptoUtils._randomWord() & 15 >> +c / 4).toString(16),\r\n        );\r\n        return uuid.replace(/-/g, \"\");\r\n    }\r\n\r\n    /**\r\n     * PKCE: Generate a code verifier\r\n     */\r\n    public static generateCodeVerifier(): string {\r\n        return CryptoUtils.generateUUIDv4() + CryptoUtils.generateUUIDv4() + CryptoUtils.generateUUIDv4();\r\n    }\r\n\r\n    /**\r\n     * PKCE: Generate a code challenge\r\n     */\r\n    public static generateCodeChallenge(code_verifier: string): string {\r\n        try {\r\n            const hashed = sha256(code_verifier);\r\n            return Base64.stringify(hashed).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\r\n        }\r\n        catch (err) {\r\n            Logger.error(\"CryptoUtils.generateCodeChallenge\", err);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generates a base64-encoded string for a basic auth header\r\n     */\r\n    public static generateBasicAuth(client_id: string, client_secret: string): string {\r\n        const basicAuth = Utf8.parse([client_id, client_secret].join(\":\"));\r\n        return Base64.stringify(basicAuth);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\n/**\r\n * Native interface\r\n *\r\n * @public\r\n */\r\nexport interface ILogger {\r\n    debug(...args: unknown[]): void;\r\n    info(...args: unknown[]): void;\r\n    warn(...args: unknown[]): void;\r\n    error(...args: unknown[]): void;\r\n}\r\n\r\nconst nopLogger: ILogger = {\r\n    debug: () => undefined,\r\n    info: () => undefined,\r\n    warn: () => undefined,\r\n    error: () => undefined,\r\n};\r\n\r\nlet level: number;\r\nlet logger: ILogger;\r\n\r\n/**\r\n * Log levels\r\n *\r\n * @public\r\n */\r\nexport enum Log {\r\n    NONE,\r\n    ERROR,\r\n    WARN,\r\n    INFO,\r\n    DEBUG\r\n}\r\n\r\n/**\r\n * Log manager\r\n *\r\n * @public\r\n */\r\nexport namespace Log { // eslint-disable-line @typescript-eslint/no-namespace\r\n    export function reset(): void {\r\n        level = Log.INFO;\r\n        logger = nopLogger;\r\n    }\r\n\r\n    export function setLevel(value: Log): void {\r\n        if (!(Log.NONE <= value && value <= Log.DEBUG)) {\r\n            throw new Error(\"Invalid log level\");\r\n        }\r\n        level = value;\r\n    }\r\n\r\n    export function setLogger(value: ILogger): void {\r\n        logger = value;\r\n    }\r\n}\r\n\r\n/**\r\n * Internal logger instance\r\n *\r\n * @public\r\n */\r\nexport class Logger {\r\n    private _method?: string;\r\n    public constructor(private _name: string) {}\r\n\r\n    public debug(...args: unknown[]): void {\r\n        if (level >= Log.DEBUG) {\r\n            logger.debug(Logger._format(this._name, this._method), ...args);\r\n        }\r\n    }\r\n    public info(...args: unknown[]): void {\r\n        if (level >= Log.INFO) {\r\n            logger.info(Logger._format(this._name, this._method), ...args);\r\n        }\r\n    }\r\n    public warn(...args: unknown[]): void {\r\n        if (level >= Log.WARN) {\r\n            logger.warn(Logger._format(this._name, this._method), ...args);\r\n        }\r\n    }\r\n    public error(...args: unknown[]): void {\r\n        if (level >= Log.ERROR) {\r\n            logger.error(Logger._format(this._name, this._method), ...args);\r\n        }\r\n    }\r\n\r\n    public throw(err: Error): never {\r\n        this.error(err);\r\n        throw err;\r\n    }\r\n\r\n    public create(method: string): Logger {\r\n        const methodLogger: Logger = Object.create(this);\r\n        methodLogger._method = method;\r\n        methodLogger.debug(\"begin\");\r\n        return methodLogger;\r\n    }\r\n\r\n    public static createStatic(name: string, staticMethod: string): Logger {\r\n        const staticLogger = new Logger(`${name}.${staticMethod}`);\r\n        staticLogger.debug(\"begin\");\r\n        return staticLogger;\r\n    }\r\n\r\n    private static _format(name: string, method?: string) {\r\n        const prefix = `[${name}]`;\r\n        return method ? `${prefix} ${method}:` : prefix;\r\n    }\r\n\r\n    // helpers for static class methods\r\n    public static debug(name: string, ...args: unknown[]): void {\r\n        if (level >= Log.DEBUG) {\r\n            logger.debug(Logger._format(name), ...args);\r\n        }\r\n    }\r\n    public static info(name: string, ...args: unknown[]): void {\r\n        if (level >= Log.INFO) {\r\n            logger.info(Logger._format(name), ...args);\r\n        }\r\n    }\r\n    public static warn(name: string, ...args: unknown[]): void {\r\n        if (level >= Log.WARN) {\r\n            logger.warn(Logger._format(name), ...args);\r\n        }\r\n    }\r\n    public static error(name: string, ...args: unknown[]): void {\r\n        if (level >= Log.ERROR) {\r\n            logger.error(Logger._format(name), ...args);\r\n        }\r\n    }\r\n}\r\n\r\nLog.reset();\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./Logger\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport type Callback<EventType extends unknown[]> = (...ev: EventType) => (Promise<void> | void);\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class Event<EventType extends unknown[]> {\r\n    protected readonly _logger = new Logger(`Event('${this._name}')`);\r\n\r\n    private _callbacks: Array<Callback<EventType>> = [];\r\n\r\n    public constructor(protected readonly _name: string) {}\r\n\r\n    public addHandler(cb: Callback<EventType>): () => void {\r\n        this._callbacks.push(cb);\r\n        return () => this.removeHandler(cb);\r\n    }\r\n\r\n    public removeHandler(cb: Callback<EventType>): void {\r\n        const idx = this._callbacks.lastIndexOf(cb);\r\n        if (idx >= 0) {\r\n            this._callbacks.splice(idx, 1);\r\n        }\r\n    }\r\n\r\n    public raise(...ev: EventType): void {\r\n        this._logger.debug(\"raise:\", ...ev);\r\n        for (const cb of this._callbacks) {\r\n            void cb(...ev);\r\n        }\r\n    }\r\n}\r\n", "/**\n * The code was extracted from:\n * https://github.com/davidchambers/Base64.js\n */\n\nvar chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\nfunction InvalidCharacterError(message) {\n    this.message = message;\n}\n\nInvalidCharacterError.prototype = new Error();\nInvalidCharacterError.prototype.name = \"InvalidCharacterError\";\n\nfunction polyfill(input) {\n    var str = String(input).replace(/=+$/, \"\");\n    if (str.length % 4 == 1) {\n        throw new InvalidCharacterError(\n            \"'atob' failed: The string to be decoded is not correctly encoded.\"\n        );\n    }\n    for (\n        // initialize result and counters\n        var bc = 0, bs, buffer, idx = 0, output = \"\";\n        // get next character\n        (buffer = str.charAt(idx++));\n        // character found in table? initialize bit storage and add its ascii value;\n        ~buffer &&\n        ((bs = bc % 4 ? bs * 64 + buffer : buffer),\n            // and if not first of each 4 characters,\n            // convert the first 8 bits to one ascii character\n            bc++ % 4) ?\n        (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6)))) :\n        0\n    ) {\n        // try to find character in table (0-63, not found => -1)\n        buffer = chars.indexOf(buffer);\n    }\n    return output;\n}\n\nexport default (typeof window !== \"undefined\" &&\n    window.atob &&\n    window.atob.bind(window)) ||\npolyfill;", "import atob from \"./atob\";\n\nfunction b64DecodeUnicode(str) {\n    return decodeURIComponent(\n        atob(str).replace(/(.)/g, function(m, p) {\n            var code = p.charCodeAt(0).toString(16).toUpperCase();\n            if (code.length < 2) {\n                code = \"0\" + code;\n            }\n            return \"%\" + code;\n        })\n    );\n}\n\nexport default function(str) {\n    var output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    switch (output.length % 4) {\n        case 0:\n            break;\n        case 2:\n            output += \"==\";\n            break;\n        case 3:\n            output += \"=\";\n            break;\n        default:\n            throw \"Illegal base64url string!\";\n    }\n\n    try {\n        return b64DecodeUnicode(output);\n    } catch (err) {\n        return atob(output);\n    }\n}", "\"use strict\";\n\nimport base64_url_decode from \"./base64_url_decode\";\n\nexport function InvalidTokenError(message) {\n    this.message = message;\n}\n\nInvalidTokenError.prototype = new Error();\nInvalidTokenError.prototype.name = \"InvalidTokenError\";\n\nexport default function(token, options) {\n    if (typeof token !== \"string\") {\n        throw new InvalidTokenError(\"Invalid token specified\");\n    }\n\n    options = options || {};\n    var pos = options.header === true ? 0 : 1;\n    try {\n        return JSON.parse(base64_url_decode(token.split(\".\")[pos]));\n    } catch (e) {\n        throw new InvalidTokenError(\"Invalid token specified: \" + e.message);\n    }\n}", "import jwt_decode from \"jwt-decode\";\r\n\r\nimport { Logger } from \"./Logger\";\r\nimport type { JwtClaims } from \"../Claims\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class JwtUtils {\r\n    // IMPORTANT: doesn't validate the token\r\n    public static decode(token: string): JwtClaims {\r\n        try {\r\n            return jwt_decode<JwtClaims>(token);\r\n        }\r\n        catch (err) {\r\n            Logger.error(\"JwtUtils.decode\", err);\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n", "/**\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/open#window_features\r\n *\r\n * @public\r\n */\r\nexport interface PopupWindowFeatures {\r\n    left?: number;\r\n    top?: number;\r\n    width?: number;\r\n    height?: number;\r\n    menubar?: boolean | string;\r\n    toolbar?: boolean | string;\r\n    location?: boolean | string;\r\n    status?: boolean | string;\r\n    resizable?: boolean | string;\r\n    scrollbars?: boolean | string;\r\n\r\n    [k: string]: boolean | string | number | undefined;\r\n}\r\n\r\nexport class PopupUtils {\r\n    /**\r\n     * Populates a map of window features with a placement centered in front of\r\n     * the current window. If no explicit width is given, a default value is\r\n     * binned into [800, 720, 600, 480, 360] based on the current window's width.\r\n     */\r\n    static center({ ...features }: PopupWindowFeatures): PopupWindowFeatures {\r\n        if (features.width == null)\r\n            features.width = [800, 720, 600, 480].find(width => width <= window.outerWidth / 1.618) ?? 360;\r\n        features.left ??= Math.max(0, Math.round(window.screenX + (window.outerWidth - features.width) / 2));\r\n        if (features.height != null)\r\n            features.top ??= Math.max(0, Math.round(window.screenY + (window.outerHeight - features.height) / 2));\r\n        return features;\r\n    }\r\n\r\n    static serialize(features: PopupWindowFeatures): string {\r\n        return Object.entries(features)\r\n            .filter(([, value]) => value != null)\r\n            .map(([key, value]) => `${key}=${typeof value !== \"boolean\" ? value as string : value ? \"yes\" : \"no\"}`)\r\n            .join(\",\");\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Event } from \"./Event\";\r\nimport { Logger } from \"./Logger\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class Timer extends Event<[void]> {\r\n    protected readonly _logger = new Logger(`Timer('${this._name}')`);\r\n    private _timerHandle: ReturnType<typeof setInterval> | null = null;\r\n    private _expiration = 0;\r\n\r\n    // get the time\r\n    public static getEpochTime(): number {\r\n        return Math.floor(Date.now() / 1000);\r\n    }\r\n\r\n    public init(durationInSeconds: number): void {\r\n        const logger = this._logger.create(\"init\");\r\n        durationInSeconds = Math.max(Math.floor(durationInSeconds), 1);\r\n        const expiration = Timer.getEpochTime() + durationInSeconds;\r\n        if (this.expiration === expiration && this._timerHandle) {\r\n            // no need to reinitialize to same expiration, so bail out\r\n            logger.debug(\"skipping since already initialized for expiration at\", this.expiration);\r\n            return;\r\n        }\r\n\r\n        this.cancel();\r\n\r\n        logger.debug(\"using duration\", durationInSeconds);\r\n        this._expiration = expiration;\r\n\r\n        // we're using a fairly short timer and then checking the expiration in the\r\n        // callback to handle scenarios where the browser device sleeps, and then\r\n        // the timers end up getting delayed.\r\n        const timerDurationInSeconds = Math.min(durationInSeconds, 5);\r\n        this._timerHandle = setInterval(this._callback, timerDurationInSeconds * 1000);\r\n    }\r\n\r\n    public get expiration(): number {\r\n        return this._expiration;\r\n    }\r\n\r\n    public cancel(): void {\r\n        this._logger.create(\"cancel\");\r\n        if (this._timerHandle) {\r\n            clearInterval(this._timerHandle);\r\n            this._timerHandle = null;\r\n        }\r\n    }\r\n\r\n    protected _callback = (): void => {\r\n        const diff = this._expiration - Timer.getEpochTime();\r\n        this._logger.debug(\"timer completes in\", diff);\r\n\r\n        if (this._expiration <= Timer.getEpochTime()) {\r\n            this.cancel();\r\n            super.raise();\r\n        }\r\n    };\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class UrlUtils {\r\n    public static readParams(url: string, responseMode: \"query\" | \"fragment\" = \"query\"): URLSearchParams {\r\n        const parsedUrl = new URL(url);\r\n        const params = parsedUrl[responseMode === \"fragment\" ? \"hash\" : \"search\"];\r\n        return new URLSearchParams(params.slice(1));\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"../utils\";\r\n\r\n/**\r\n * Error class thrown in case of an authentication error.\r\n *\r\n * See https://openid.net/specs/openid-connect-core-1_0.html#AuthError\r\n *\r\n * @public\r\n */\r\nexport class ErrorResponse extends Error {\r\n    /** Marker to detect class: \"ErrorResponse\" */\r\n    public readonly name: string = \"ErrorResponse\";\r\n\r\n    /** An error code string that can be used to classify the types of errors that occur and to respond to errors. */\r\n    public readonly error: string | null;\r\n    /** additional information that can help a developer identify the cause of the error.*/\r\n    public readonly error_description: string | null;\r\n    /**\r\n     * URI identifying a human-readable web page with information about the error, used to provide the client\r\n       developer with additional information about the error.\r\n    */\r\n    public readonly error_uri: string | null;\r\n\r\n    /** custom state data set during the initial signin request */\r\n    public state?: unknown;\r\n\r\n    public readonly session_state: string | null;\r\n\r\n    public constructor(\r\n        args: {\r\n            error?: string | null; error_description?: string | null; error_uri?: string | null;\r\n            userState?: unknown; session_state?: string | null;\r\n        },\r\n        /** The x-www-form-urlencoded request body sent to the authority server */\r\n        public readonly form?: URLSearchParams,\r\n    ) {\r\n        super(args.error_description || args.error || \"\");\r\n\r\n        if (!args.error) {\r\n            Logger.error(\"ErrorResponse\", \"No error passed\");\r\n            throw new Error(\"No error passed\");\r\n        }\r\n\r\n        this.error = args.error;\r\n        this.error_description = args.error_description ?? null;\r\n        this.error_uri = args.error_uri ?? null;\r\n\r\n        this.state = args.userState;\r\n        this.session_state = args.session_state ?? null;\r\n    }\r\n}\r\n", "// Copyright (C) 2021 AuthTS Contributors\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\n/**\r\n * Error class thrown in case of network timeouts (e.g IFrame time out).\r\n *\r\n * @public\r\n */\r\nexport class ErrorTimeout extends Error {\r\n    /** Marker to detect class: \"ErrorTimeout\" */\r\n    public readonly name: string = \"ErrorTimeout\";\r\n\r\n    public constructor(message?: string) {\r\n        super(message);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, Timer } from \"./utils\";\r\nimport type { User } from \"./User\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport type AccessTokenCallback = (...ev: unknown[]) => (Promise<void> | void);\r\n\r\n/**\r\n * @public\r\n */\r\nexport class AccessTokenEvents {\r\n    protected readonly _logger = new Logger(\"AccessTokenEvents\");\r\n\r\n    private readonly _expiringTimer = new Timer(\"Access token expiring\");\r\n    private readonly _expiredTimer = new Timer(\"Access token expired\");\r\n    private readonly _expiringNotificationTimeInSeconds: number;\r\n\r\n    public constructor(args: { expiringNotificationTimeInSeconds: number }) {\r\n        this._expiringNotificationTimeInSeconds = args.expiringNotificationTimeInSeconds;\r\n    }\r\n\r\n    public load(container: User): void {\r\n        const logger = this._logger.create(\"load\");\r\n        // only register events if there's an access token and it has an expiration\r\n        if (container.access_token && container.expires_in !== undefined) {\r\n            const duration = container.expires_in;\r\n            logger.debug(\"access token present, remaining duration:\", duration);\r\n\r\n            if (duration > 0) {\r\n                // only register expiring if we still have time\r\n                let expiring = duration - this._expiringNotificationTimeInSeconds;\r\n                if (expiring <= 0) {\r\n                    expiring = 1;\r\n                }\r\n\r\n                logger.debug(\"registering expiring timer, raising in\", expiring, \"seconds\");\r\n                this._expiringTimer.init(expiring);\r\n            }\r\n            else {\r\n                logger.debug(\"canceling existing expiring timer because we're past expiration.\");\r\n                this._expiringTimer.cancel();\r\n            }\r\n\r\n            // if it's negative, it will still fire\r\n            const expired = duration + 1;\r\n            logger.debug(\"registering expired timer, raising in\", expired, \"seconds\");\r\n            this._expiredTimer.init(expired);\r\n        }\r\n        else {\r\n            this._expiringTimer.cancel();\r\n            this._expiredTimer.cancel();\r\n        }\r\n    }\r\n\r\n    public unload(): void {\r\n        this._logger.debug(\"unload: canceling existing access token timers\");\r\n        this._expiringTimer.cancel();\r\n        this._expiredTimer.cancel();\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised prior to the access token expiring.\r\n     */\r\n    public addAccessTokenExpiring(cb: AccessTokenCallback): () => void {\r\n        return this._expiringTimer.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised prior to the access token expiring.\r\n     */\r\n    public removeAccessTokenExpiring(cb: AccessTokenCallback): void {\r\n        this._expiringTimer.removeHandler(cb);\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised after the access token has expired.\r\n     */\r\n    public addAccessTokenExpired(cb: AccessTokenCallback): () => void {\r\n        return this._expiredTimer.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised after the access token has expired.\r\n     */\r\n    public removeAccessTokenExpired(cb: AccessTokenCallback): void {\r\n        this._expiredTimer.removeHandler(cb);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class CheckSessionIFrame {\r\n    private readonly _logger = new Logger(\"CheckSessionIFrame\");\r\n    private _frame_origin: string;\r\n    private _frame: HTMLIFrameElement;\r\n    private _timer: ReturnType<typeof setInterval> | null = null;\r\n    private _session_state: string | null = null;\r\n\r\n    public constructor(\r\n        private _callback: () => Promise<void>,\r\n        private _client_id: string,\r\n        url: string,\r\n        private _intervalInSeconds: number,\r\n        private _stopOnError: boolean,\r\n    ) {\r\n        const parsedUrl = new URL(url);\r\n        this._frame_origin = parsedUrl.origin;\r\n\r\n        this._frame = window.document.createElement(\"iframe\");\r\n\r\n        // shotgun approach\r\n        this._frame.style.visibility = \"hidden\";\r\n        this._frame.style.position = \"fixed\";\r\n        this._frame.style.left = \"-1000px\";\r\n        this._frame.style.top = \"0\";\r\n        this._frame.width = \"0\";\r\n        this._frame.height = \"0\";\r\n        this._frame.src = parsedUrl.href;\r\n    }\r\n\r\n    public load(): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            this._frame.onload = () => {\r\n                resolve();\r\n            };\r\n\r\n            window.document.body.appendChild(this._frame);\r\n            window.addEventListener(\"message\", this._message, false);\r\n        });\r\n    }\r\n\r\n    private _message = (e: MessageEvent<string>): void => {\r\n        if (e.origin === this._frame_origin &&\r\n            e.source === this._frame.contentWindow\r\n        ) {\r\n            if (e.data === \"error\") {\r\n                this._logger.error(\"error message from check session op iframe\");\r\n                if (this._stopOnError) {\r\n                    this.stop();\r\n                }\r\n            }\r\n            else if (e.data === \"changed\") {\r\n                this._logger.debug(\"changed message from check session op iframe\");\r\n                this.stop();\r\n                void this._callback();\r\n            }\r\n            else {\r\n                this._logger.debug(e.data + \" message from check session op iframe\");\r\n            }\r\n        }\r\n    };\r\n\r\n    public start(session_state: string): void {\r\n        if (this._session_state === session_state) {\r\n            return;\r\n        }\r\n\r\n        this._logger.create(\"start\");\r\n\r\n        this.stop();\r\n\r\n        this._session_state = session_state;\r\n\r\n        const send = () => {\r\n            if (!this._frame.contentWindow || !this._session_state) {\r\n                return;\r\n            }\r\n\r\n            this._frame.contentWindow.postMessage(this._client_id + \" \" + this._session_state, this._frame_origin);\r\n        };\r\n\r\n        // trigger now\r\n        send();\r\n\r\n        // and setup timer\r\n        this._timer = setInterval(send, this._intervalInSeconds * 1000);\r\n    }\r\n\r\n    public stop(): void {\r\n        this._logger.create(\"stop\");\r\n        this._session_state = null;\r\n\r\n        if (this._timer) {\r\n\r\n            clearInterval(this._timer);\r\n            this._timer = null;\r\n        }\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class InMemoryWebStorage implements Storage {\r\n    private readonly _logger = new Logger(\"InMemoryWebStorage\");\r\n    private _data: Record<string, string> = {};\r\n\r\n    public clear(): void {\r\n        this._logger.create(\"clear\");\r\n        this._data = {};\r\n    }\r\n\r\n    public getItem(key: string): string {\r\n        this._logger.create(`getItem('${key}')`);\r\n        return this._data[key];\r\n    }\r\n\r\n    public setItem(key: string, value: string): void {\r\n        this._logger.create(`setItem('${key}')`);\r\n        this._data[key] = value;\r\n    }\r\n\r\n    public removeItem(key: string): void {\r\n        this._logger.create(`removeItem('${key}')`);\r\n        delete this._data[key];\r\n    }\r\n\r\n    public get length(): number {\r\n        return Object.getOwnPropertyNames(this._data).length;\r\n    }\r\n\r\n    public key(index: number): string {\r\n        return Object.getOwnPropertyNames(this._data)[index];\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { ErrorResponse, ErrorTimeout } from \"./errors\";\r\nimport { Logger } from \"./utils\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport type JwtHandler = (text: string) => Promise<Record<string, unknown>>;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GetJsonOpts {\r\n    token?: string;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface PostFormOpts {\r\n    body: URLSearchParams;\r\n    basicAuth?: string;\r\n    timeoutInSeconds?: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class JsonService {\r\n    private readonly _logger = new Logger(\"JsonService\");\r\n\r\n    private _contentTypes: string[] = [];\r\n\r\n    public constructor(\r\n        additionalContentTypes: string[] = [],\r\n        private _jwtHandler: JwtHandler | null = null,\r\n    ) {\r\n        this._contentTypes.push(...additionalContentTypes, \"application/json\");\r\n        if (_jwtHandler) {\r\n            this._contentTypes.push(\"application/jwt\");\r\n        }\r\n    }\r\n\r\n    protected async fetchWithTimeout(input: RequestInfo, init: RequestInit & { timeoutInSeconds?: number } = {}) {\r\n        const { timeoutInSeconds, ...initFetch } = init;\r\n        if (!timeoutInSeconds) {\r\n            return await fetch(input, initFetch);\r\n        }\r\n\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), timeoutInSeconds * 1000);\r\n\r\n        try {\r\n            const response = await fetch(input, {\r\n                ...init,\r\n                signal: controller.signal,\r\n            });\r\n            return response;\r\n        }\r\n        catch (err) {\r\n            if (err instanceof DOMException && err.name === \"AbortError\") {\r\n                throw new ErrorTimeout(\"Network timed out\");\r\n            }\r\n            throw err;\r\n        }\r\n        finally {\r\n            clearTimeout(timeoutId);\r\n        }\r\n    }\r\n\r\n    public async getJson(url: string, {\r\n        token,\r\n    }: GetJsonOpts = {}): Promise<Record<string, unknown>> {\r\n        const logger = this._logger.create(\"getJson\");\r\n        const headers: HeadersInit = {\r\n            \"Accept\": this._contentTypes.join(\", \"),\r\n        };\r\n        if (token) {\r\n            logger.debug(\"token passed, setting Authorization header\");\r\n            headers[\"Authorization\"] = \"Bearer \" + token;\r\n        }\r\n\r\n        let response: Response;\r\n        try {\r\n            logger.debug(\"url:\", url);\r\n            response = await this.fetchWithTimeout(url, { method: \"GET\", headers });\r\n        }\r\n        catch (err) {\r\n            logger.error(\"Network Error\");\r\n            throw err;\r\n        }\r\n\r\n        logger.debug(\"HTTP response received, status\", response.status);\r\n        const contentType = response.headers.get(\"Content-Type\");\r\n        if (contentType && !this._contentTypes.find(item => contentType.startsWith(item))) {\r\n            logger.throw(new Error(`Invalid response Content-Type: ${(contentType ?? \"undefined\")}, from URL: ${url}`));\r\n        }\r\n        if (response.ok && this._jwtHandler && contentType?.startsWith(\"application/jwt\")) {\r\n            return await this._jwtHandler(await response.text());\r\n        }\r\n        let json: Record<string, unknown>;\r\n        try {\r\n            json = await response.json();\r\n        }\r\n        catch (err) {\r\n            logger.error(\"Error parsing JSON response\", err);\r\n            if (response.ok) throw err;\r\n            throw new Error(`${response.statusText} (${response.status})`);\r\n        }\r\n        if (!response.ok) {\r\n            logger.error(\"Error from server:\", json);\r\n            if (json.error) {\r\n                throw new ErrorResponse(json);\r\n            }\r\n            throw new Error(`${response.statusText} (${response.status}): ${JSON.stringify(json)}`);\r\n        }\r\n        return json;\r\n    }\r\n\r\n    public async postForm(url: string, {\r\n        body,\r\n        basicAuth,\r\n        timeoutInSeconds,\r\n    }: PostFormOpts): Promise<Record<string, unknown>> {\r\n        const logger = this._logger.create(\"postForm\");\r\n        const headers: HeadersInit = {\r\n            \"Accept\": this._contentTypes.join(\", \"),\r\n            \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n        };\r\n        if (basicAuth !== undefined) {\r\n            headers[\"Authorization\"] = \"Basic \" + basicAuth;\r\n        }\r\n\r\n        let response: Response;\r\n        try {\r\n            logger.debug(\"url:\", url);\r\n            response = await this.fetchWithTimeout(url, { method: \"POST\", headers, body, timeoutInSeconds });\r\n        }\r\n        catch (err) {\r\n            logger.error(\"Network error\");\r\n            throw err;\r\n        }\r\n\r\n        logger.debug(\"HTTP response received, status\", response.status);\r\n        const contentType = response.headers.get(\"Content-Type\");\r\n        if (contentType && !this._contentTypes.find(item => contentType.startsWith(item))) {\r\n            throw new Error(`Invalid response Content-Type: ${(contentType ?? \"undefined\")}, from URL: ${url}`);\r\n        }\r\n\r\n        const responseText = await response.text();\r\n\r\n        let json: Record<string, unknown> = {};\r\n        if (responseText) {\r\n            try {\r\n                json = JSON.parse(responseText);\r\n            }\r\n            catch (err) {\r\n                logger.error(\"Error parsing JSON response\", err);\r\n                if (response.ok) throw err;\r\n                throw new Error(`${response.statusText} (${response.status})`);\r\n            }\r\n        }\r\n\r\n        if (!response.ok) {\r\n            logger.error(\"Error from server:\", json);\r\n            if (json.error) {\r\n                throw new ErrorResponse(json, body);\r\n            }\r\n            throw new Error(`${response.statusText} (${response.status}): ${JSON.stringify(json)}`);\r\n        }\r\n\r\n        return json;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\nimport { JsonService } from \"./JsonService\";\r\nimport type { OidcClientSettingsStore, SigningKey } from \"./OidcClientSettings\";\r\nimport type { OidcMetadata } from \"./OidcMetadata\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class MetadataService {\r\n    private readonly _logger = new Logger(\"MetadataService\");\r\n    private readonly _jsonService = new JsonService([\"application/jwk-set+json\"]);\r\n\r\n    // cache\r\n    private _metadataUrl: string;\r\n    private _signingKeys: SigningKey[] | null = null;\r\n    private _metadata: Partial<OidcMetadata> | null = null;\r\n\r\n    public constructor(private readonly _settings: OidcClientSettingsStore) {\r\n        this._metadataUrl = this._settings.metadataUrl;\r\n\r\n        if (this._settings.signingKeys) {\r\n            this._logger.debug(\"using signingKeys from settings\");\r\n            this._signingKeys = this._settings.signingKeys;\r\n        }\r\n\r\n        if (this._settings.metadata) {\r\n            this._logger.debug(\"using metadata from settings\");\r\n            this._metadata = this._settings.metadata;\r\n        }\r\n    }\r\n\r\n    public resetSigningKeys(): void {\r\n        this._signingKeys = null;\r\n    }\r\n\r\n    public async getMetadata(): Promise<Partial<OidcMetadata>> {\r\n        const logger = this._logger.create(\"getMetadata\");\r\n        if (this._metadata) {\r\n            logger.debug(\"using cached values\");\r\n            return this._metadata;\r\n        }\r\n\r\n        if (!this._metadataUrl) {\r\n            logger.throw(new Error(\"No authority or metadataUrl configured on settings\"));\r\n            throw null;\r\n        }\r\n\r\n        logger.debug(\"getting metadata from\", this._metadataUrl);\r\n        const metadata = await this._jsonService.getJson(this._metadataUrl);\r\n\r\n        logger.debug(\"merging remote JSON with seed metadata\");\r\n        this._metadata = Object.assign({}, this._settings.metadataSeed, metadata);\r\n        return this._metadata;\r\n    }\r\n\r\n    public getIssuer(): Promise<string> {\r\n        return this._getMetadataProperty(\"issuer\") as Promise<string>;\r\n    }\r\n\r\n    public getAuthorizationEndpoint(): Promise<string> {\r\n        return this._getMetadataProperty(\"authorization_endpoint\") as Promise<string>;\r\n    }\r\n\r\n    public getUserInfoEndpoint(): Promise<string> {\r\n        return this._getMetadataProperty(\"userinfo_endpoint\") as Promise<string>;\r\n    }\r\n\r\n    public getTokenEndpoint(optional: false): Promise<string>;\r\n    public getTokenEndpoint(optional?: true): Promise<string | undefined>;\r\n    public getTokenEndpoint(optional = true): Promise<string | undefined> {\r\n        return this._getMetadataProperty(\"token_endpoint\", optional) as Promise<string | undefined>;\r\n    }\r\n\r\n    public getCheckSessionIframe(): Promise<string | undefined> {\r\n        return this._getMetadataProperty(\"check_session_iframe\", true) as Promise<string | undefined>;\r\n    }\r\n\r\n    public getEndSessionEndpoint(): Promise<string | undefined> {\r\n        return this._getMetadataProperty(\"end_session_endpoint\", true) as Promise<string | undefined>;\r\n    }\r\n\r\n    public getRevocationEndpoint(optional: false): Promise<string>;\r\n    public getRevocationEndpoint(optional?: true): Promise<string | undefined>;\r\n    public getRevocationEndpoint(optional = true): Promise<string | undefined> {\r\n        return this._getMetadataProperty(\"revocation_endpoint\", optional) as Promise<string | undefined>;\r\n    }\r\n\r\n    public getKeysEndpoint(optional: false): Promise<string>;\r\n    public getKeysEndpoint(optional?: true): Promise<string | undefined>;\r\n    public getKeysEndpoint(optional = true): Promise<string | undefined> {\r\n        return this._getMetadataProperty(\"jwks_uri\", optional) as Promise<string | undefined>;\r\n    }\r\n\r\n    protected async _getMetadataProperty(name: keyof OidcMetadata, optional=false): Promise<string | boolean | string[] | undefined> {\r\n        const logger = this._logger.create(`_getMetadataProperty('${name}')`);\r\n\r\n        const metadata = await this.getMetadata();\r\n        logger.debug(\"resolved\");\r\n\r\n        if (metadata[name] === undefined) {\r\n            if (optional === true) {\r\n                logger.warn(\"Metadata does not contain optional property\");\r\n                return undefined;\r\n            }\r\n\r\n            logger.throw(new Error(\"Metadata does not contain property \" + name));\r\n        }\r\n\r\n        return metadata[name];\r\n    }\r\n\r\n    public async getSigningKeys(): Promise<SigningKey[] | null> {\r\n        const logger = this._logger.create(\"getSigningKeys\");\r\n        if (this._signingKeys) {\r\n            logger.debug(\"returning signingKeys from cache\");\r\n            return this._signingKeys;\r\n        }\r\n\r\n        const jwks_uri = await this.getKeysEndpoint(false);\r\n        logger.debug(\"got jwks_uri\", jwks_uri);\r\n\r\n        const keySet = await this._jsonService.getJson(jwks_uri);\r\n        logger.debug(\"got key set\", keySet);\r\n\r\n        if (!Array.isArray(keySet.keys)) {\r\n            logger.throw(new Error(\"Missing keys on keyset\"));\r\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n        }\r\n\r\n        this._signingKeys = keySet.keys;\r\n        return this._signingKeys;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\nimport type { StateStore } from \"./StateStore\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class WebStorageStateStore implements StateStore {\r\n    private readonly _logger = new Logger(\"WebStorageStateStore\");\r\n\r\n    private readonly _store: Storage;\r\n    private readonly _prefix: string;\r\n\r\n    public constructor({ prefix = \"oidc.\", store = localStorage } = {}) {\r\n        this._store = store;\r\n        this._prefix = prefix;\r\n    }\r\n\r\n    public set(key: string, value: string): Promise<void> {\r\n        this._logger.create(`set('${key}')`);\r\n\r\n        key = this._prefix + key;\r\n        this._store.setItem(key, value);\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public get(key: string): Promise<string | null> {\r\n        this._logger.create(`get('${key}')`);\r\n\r\n        key = this._prefix + key;\r\n        const item = this._store.getItem(key);\r\n        return Promise.resolve(item);\r\n    }\r\n\r\n    public remove(key: string): Promise<string | null> {\r\n        this._logger.create(`remove('${key}')`);\r\n\r\n        key = this._prefix + key;\r\n        const item = this._store.getItem(key);\r\n        this._store.removeItem(key);\r\n        return Promise.resolve(item);\r\n    }\r\n\r\n    public getAllKeys(): Promise<string[]> {\r\n        this._logger.create(\"getAllKeys\");\r\n\r\n        const keys = [];\r\n        for (let index = 0; index < this._store.length; index++) {\r\n            const key = this._store.key(index);\r\n            if (key && key.indexOf(this._prefix) === 0) {\r\n                keys.push(key.substr(this._prefix.length));\r\n            }\r\n        }\r\n        return Promise.resolve(keys);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { WebStorageStateStore } from \"./WebStorageStateStore\";\r\nimport type { OidcMetadata } from \"./OidcMetadata\";\r\nimport type { StateStore } from \"./StateStore\";\r\nimport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\r\n\r\nconst DefaultResponseType = \"code\";\r\nconst DefaultScope = \"openid\";\r\nconst DefaultClientAuthentication = \"client_secret_post\";\r\nconst DefaultResponseMode = \"query\";\r\nconst DefaultStaleStateAgeInSeconds = 60 * 15;\r\nconst DefaultClockSkewInSeconds = 60 * 5;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type SigningKey = Record<string, string | string[]>;\r\n\r\n/**\r\n * The settings used to configure the {@link OidcClient}.\r\n *\r\n * @public\r\n */\r\nexport interface OidcClientSettings {\r\n    /** The URL of the OIDC/OAuth2 provider */\r\n    authority: string;\r\n    metadataUrl?: string;\r\n    /** Provide metadata when authority server does not allow CORS on the metadata endpoint */\r\n    metadata?: Partial<OidcMetadata>;\r\n    /** Can be used to seed or add additional values to the results of the discovery request */\r\n    metadataSeed?: Partial<OidcMetadata>;\r\n    /** Provide signingKeys when authority server does not allow CORS on the jwks uri */\r\n    signingKeys?: SigningKey[];\r\n\r\n    /** Your client application's identifier as registered with the OIDC/OAuth2 */\r\n    client_id: string;\r\n    client_secret?: string;\r\n    /** The type of response desired from the OIDC/OAuth2 provider (default: \"code\") */\r\n    response_type?: string;\r\n    /** The scope being requested from the OIDC/OAuth2 provider (default: \"openid\") */\r\n    scope?: string;\r\n    /** The redirect URI of your client application to receive a response from the OIDC/OAuth2 provider */\r\n    redirect_uri: string;\r\n    /** The OIDC/OAuth2 post-logout redirect URI */\r\n    post_logout_redirect_uri?: string;\r\n\r\n    /**\r\n     * Client authentication method that is used to authenticate when using the token endpoint (default: \"client_secret_post\")\r\n     * - \"client_secret_basic\": using the HTTP Basic authentication scheme\r\n     * - \"client_secret_post\": including the client credentials in the request body\r\n     *\r\n     * See https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication\r\n     */\r\n    client_authentication?: \"client_secret_basic\" | \"client_secret_post\";\r\n\r\n    /** optional protocol param */\r\n    prompt?: string;\r\n    /** optional protocol param */\r\n    display?: string;\r\n    /** optional protocol param */\r\n    max_age?: number;\r\n    /** optional protocol param */\r\n    ui_locales?: string;\r\n    /** optional protocol param */\r\n    acr_values?: string;\r\n    /** optional protocol param */\r\n    resource?: string;\r\n\r\n    /** optional protocol param (default: \"query\") */\r\n    response_mode?: \"query\" | \"fragment\";\r\n\r\n    /** Should OIDC protocol claims be removed from profile (default: true) */\r\n    filterProtocolClaims?: boolean;\r\n    /** Flag to control if additional identity data is loaded from the user info endpoint in order to populate the user's profile (default: false) */\r\n    loadUserInfo?: boolean;\r\n    /** Number (in seconds) indicating the age of state entries in storage for authorize requests that are considered abandoned and thus can be cleaned up (default: 300) */\r\n    staleStateAgeInSeconds?: number;\r\n    /** The window of time (in seconds) to allow the current time to deviate when validating token's iat, nbf, and exp values (default: 300) */\r\n    clockSkewInSeconds?: number;\r\n    userInfoJwtIssuer?: \"ANY\" | \"OP\" | string;\r\n\r\n    /**\r\n     * Indicates if objects returned from the user info endpoint as claims (e.g. `address`) are merged into the claims from the id token as a single object.\r\n     * Otherwise, they are added to an array as distinct objects for the claim type. (default: false)\r\n     */\r\n    mergeClaims?: boolean;\r\n\r\n    /**\r\n     * Storage object used to persist interaction state (default: window.localStorage, InMemoryWebStorage iff no window).\r\n     * E.g. `stateStore: new WebStorageStateStore({ store: window.localStorage })`\r\n     */\r\n    stateStore?: StateStore;\r\n\r\n    /**\r\n     * An object containing additional query string parameters to be including in the authorization request.\r\n     * E.g, when using Azure AD to obtain an access token an additional resource parameter is required. extraQueryParams: `{resource:\"some_identifier\"}`\r\n     */\r\n    extraQueryParams?: Record<string, string | number | boolean>;\r\n\r\n    extraTokenParams?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * The settings with defaults applied of the {@link OidcClient}.\r\n * @see {@link OidcClientSettings}\r\n *\r\n * @public\r\n */\r\nexport class OidcClientSettingsStore {\r\n    // metadata\r\n    public readonly authority: string;\r\n    public readonly metadataUrl: string;\r\n    public readonly metadata: Partial<OidcMetadata> | undefined;\r\n    public readonly metadataSeed: Partial<OidcMetadata> | undefined;\r\n    public readonly signingKeys: SigningKey[] | undefined;\r\n\r\n    // client config\r\n    public readonly client_id: string;\r\n    public readonly client_secret: string | undefined;\r\n    public readonly response_type: string;\r\n    public readonly scope: string;\r\n    public readonly redirect_uri: string;\r\n    public readonly post_logout_redirect_uri: string | undefined;\r\n    public readonly client_authentication: \"client_secret_basic\" | \"client_secret_post\";\r\n\r\n    // optional protocol params\r\n    public readonly prompt: string | undefined;\r\n    public readonly display: string | undefined;\r\n    public readonly max_age: number | undefined;\r\n    public readonly ui_locales: string | undefined;\r\n    public readonly acr_values: string | undefined;\r\n    public readonly resource: string | undefined;\r\n    public readonly response_mode: \"query\" | \"fragment\";\r\n\r\n    // behavior flags\r\n    public readonly filterProtocolClaims: boolean;\r\n    public readonly loadUserInfo: boolean;\r\n    public readonly staleStateAgeInSeconds: number;\r\n    public readonly clockSkewInSeconds: number;\r\n    public readonly userInfoJwtIssuer: \"ANY\" | \"OP\" | string;\r\n    public readonly mergeClaims: boolean;\r\n\r\n    public readonly stateStore: StateStore;\r\n\r\n    // extra\r\n    public readonly extraQueryParams: Record<string, string | number | boolean>;\r\n    public readonly extraTokenParams: Record<string, unknown>;\r\n\r\n    public constructor({\r\n        // metadata related\r\n        authority, metadataUrl, metadata, signingKeys, metadataSeed,\r\n        // client related\r\n        client_id, client_secret, response_type = DefaultResponseType, scope = DefaultScope,\r\n        redirect_uri, post_logout_redirect_uri,\r\n        client_authentication = DefaultClientAuthentication,\r\n        // optional protocol\r\n        prompt, display, max_age, ui_locales, acr_values, resource, response_mode = DefaultResponseMode,\r\n        // behavior flags\r\n        filterProtocolClaims = true,\r\n        loadUserInfo = false,\r\n        staleStateAgeInSeconds = DefaultStaleStateAgeInSeconds,\r\n        clockSkewInSeconds = DefaultClockSkewInSeconds,\r\n        userInfoJwtIssuer = \"OP\",\r\n        mergeClaims = false,\r\n        // other behavior\r\n        stateStore,\r\n        // extra query params\r\n        extraQueryParams = {},\r\n        extraTokenParams = {},\r\n    }: OidcClientSettings) {\r\n\r\n        this.authority = authority;\r\n\r\n        if (metadataUrl) {\r\n            this.metadataUrl = metadataUrl;\r\n        } else {\r\n            this.metadataUrl = authority;\r\n            if (authority) {\r\n                if (!this.metadataUrl.endsWith(\"/\")) {\r\n                    this.metadataUrl += \"/\";\r\n                }\r\n                this.metadataUrl += \".well-known/openid-configuration\";\r\n            }\r\n        }\r\n\r\n        this.metadata = metadata;\r\n        this.metadataSeed = metadataSeed;\r\n        this.signingKeys = signingKeys;\r\n\r\n        this.client_id = client_id;\r\n        this.client_secret = client_secret;\r\n        this.response_type = response_type;\r\n        this.scope = scope;\r\n        this.redirect_uri = redirect_uri;\r\n        this.post_logout_redirect_uri = post_logout_redirect_uri;\r\n        this.client_authentication = client_authentication;\r\n\r\n        this.prompt = prompt;\r\n        this.display = display;\r\n        this.max_age = max_age;\r\n        this.ui_locales = ui_locales;\r\n        this.acr_values = acr_values;\r\n        this.resource = resource;\r\n        this.response_mode = response_mode;\r\n\r\n        this.filterProtocolClaims = !!filterProtocolClaims;\r\n        this.loadUserInfo = !!loadUserInfo;\r\n        this.staleStateAgeInSeconds = staleStateAgeInSeconds;\r\n        this.clockSkewInSeconds = clockSkewInSeconds;\r\n        this.userInfoJwtIssuer = userInfoJwtIssuer;\r\n        this.mergeClaims = !!mergeClaims;\r\n\r\n        if (stateStore) {\r\n            this.stateStore = stateStore;\r\n        }\r\n        else {\r\n            const store = typeof window !== \"undefined\" ? window.localStorage : new InMemoryWebStorage();\r\n            this.stateStore = new WebStorageStateStore({ store });\r\n        }\r\n\r\n        this.extraQueryParams = extraQueryParams;\r\n        this.extraTokenParams = extraTokenParams;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, JwtUtils } from \"./utils\";\r\nimport { JsonService } from \"./JsonService\";\r\nimport type { MetadataService } from \"./MetadataService\";\r\nimport type { JwtClaims } from \"./Claims\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class UserInfoService {\r\n    protected readonly _logger = new Logger(\"UserInfoService\");\r\n    private readonly _jsonService: JsonService;\r\n\r\n    public constructor(private readonly _metadataService: MetadataService) {\r\n        this._jsonService = new JsonService(undefined, this._getClaimsFromJwt);\r\n    }\r\n\r\n    public async getClaims(token: string): Promise<JwtClaims> {\r\n        const logger = this._logger.create(\"getClaims\");\r\n        if (!token) {\r\n            this._logger.throw(new Error(\"No token passed\"));\r\n        }\r\n\r\n        const url = await this._metadataService.getUserInfoEndpoint();\r\n        logger.debug(\"got userinfo url\", url);\r\n\r\n        const claims = await this._jsonService.getJson(url, { token });\r\n        logger.debug(\"got claims\", claims);\r\n\r\n        return claims;\r\n    }\r\n\r\n    protected _getClaimsFromJwt = async (responseText: string): Promise<JwtClaims> => {\r\n        const logger = this._logger.create(\"_getClaimsFromJwt\");\r\n        try {\r\n            const payload = JwtUtils.decode(responseText);\r\n            logger.debug(\"JWT decoding successful\");\r\n\r\n            return payload;\r\n        }\r\n        catch (err) {\r\n            logger.error(\"Error parsing JWT response\");\r\n            throw err;\r\n        }\r\n    };\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { CryptoUtils, Logger } from \"./utils\";\r\nimport { JsonService } from \"./JsonService\";\r\nimport type { MetadataService } from \"./MetadataService\";\r\nimport type { OidcClientSettingsStore } from \"./OidcClientSettings\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ExchangeCodeArgs {\r\n    client_id?: string;\r\n    client_secret?: string;\r\n    redirect_uri?: string;\r\n\r\n    grant_type?: string;\r\n    code: string;\r\n    code_verifier?: string;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface ExchangeRefreshTokenArgs {\r\n    client_id?: string;\r\n    client_secret?: string;\r\n\r\n    grant_type?: string;\r\n    refresh_token: string;\r\n    scope?: string;\r\n\r\n    timeoutInSeconds?: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface RevokeArgs {\r\n    token: string;\r\n    token_type_hint?: \"access_token\" | \"refresh_token\";\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class TokenClient {\r\n    private readonly _logger = new Logger(\"TokenClient\");\r\n    private readonly _jsonService = new JsonService();\r\n\r\n    public constructor(\r\n        private readonly _settings: OidcClientSettingsStore,\r\n        private readonly _metadataService: MetadataService,\r\n    ) {}\r\n\r\n    public async exchangeCode({\r\n        grant_type = \"authorization_code\",\r\n        redirect_uri = this._settings.redirect_uri,\r\n        client_id = this._settings.client_id,\r\n        client_secret = this._settings.client_secret,\r\n        ...args\r\n    }: ExchangeCodeArgs): Promise<Record<string, unknown>> {\r\n        const logger = this._logger.create(\"exchangeCode\");\r\n        if (!client_id) {\r\n            logger.throw(new Error(\"A client_id is required\"));\r\n        }\r\n        if (!redirect_uri) {\r\n            logger.throw(new Error(\"A redirect_uri is required\"));\r\n        }\r\n        if (!args.code) {\r\n            logger.throw(new Error(\"A code is required\"));\r\n        }\r\n        if (!args.code_verifier) {\r\n            logger.throw(new Error(\"A code_verifier is required\"));\r\n        }\r\n\r\n        const params = new URLSearchParams({ grant_type, redirect_uri });\r\n        for (const [key, value] of Object.entries(args)) {\r\n            if (value != null) {\r\n                params.set(key, value);\r\n            }\r\n        }\r\n        let basicAuth: string | undefined;\r\n        switch (this._settings.client_authentication) {\r\n            case \"client_secret_basic\":\r\n                if (!client_secret) {\r\n                    logger.throw(new Error(\"A client_secret is required\"));\r\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n                }\r\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\r\n                break;\r\n            case \"client_secret_post\":\r\n                params.append(\"client_id\", client_id);\r\n                if (client_secret) {\r\n                    params.append(\"client_secret\", client_secret);\r\n                }\r\n                break;\r\n        }\r\n\r\n        const url = await this._metadataService.getTokenEndpoint(false);\r\n        logger.debug(\"got token endpoint\");\r\n\r\n        const response = await this._jsonService.postForm(url, { body: params, basicAuth });\r\n        logger.debug(\"got response\");\r\n\r\n        return response;\r\n    }\r\n\r\n    public async exchangeRefreshToken({\r\n        grant_type = \"refresh_token\",\r\n        client_id = this._settings.client_id,\r\n        client_secret = this._settings.client_secret,\r\n        timeoutInSeconds,\r\n        ...args\r\n    }: ExchangeRefreshTokenArgs): Promise<Record<string, unknown>> {\r\n        const logger = this._logger.create(\"exchangeRefreshToken\");\r\n        if (!client_id) {\r\n            logger.throw(new Error(\"A client_id is required\"));\r\n        }\r\n        if (!args.refresh_token) {\r\n            logger.throw(new Error(\"A refresh_token is required\"));\r\n        }\r\n\r\n        const params = new URLSearchParams({ grant_type });\r\n        for (const [key, value] of Object.entries(args)) {\r\n            if (value != null) {\r\n                params.set(key, value);\r\n            }\r\n        }\r\n        let basicAuth: string | undefined;\r\n        switch (this._settings.client_authentication) {\r\n            case \"client_secret_basic\":\r\n                if (!client_secret) {\r\n                    logger.throw(new Error(\"A client_secret is required\"));\r\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n                }\r\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\r\n                break;\r\n            case \"client_secret_post\":\r\n                params.append(\"client_id\", client_id);\r\n                if (client_secret) {\r\n                    params.append(\"client_secret\", client_secret);\r\n                }\r\n                break;\r\n        }\r\n\r\n        const url = await this._metadataService.getTokenEndpoint(false);\r\n        logger.debug(\"got token endpoint\");\r\n\r\n        const response = await this._jsonService.postForm(url, { body: params, basicAuth, timeoutInSeconds });\r\n        logger.debug(\"got response\");\r\n\r\n        return response;\r\n    }\r\n\r\n    /**\r\n     * Revoke an access or refresh token.\r\n     *\r\n     * @see https://datatracker.ietf.org/doc/html/rfc7009#section-2.1\r\n     */\r\n    public async revoke(args: RevokeArgs): Promise<void> {\r\n        const logger = this._logger.create(\"revoke\");\r\n        if (!args.token) {\r\n            logger.throw(new Error(\"A token is required\"));\r\n        }\r\n\r\n        const url = await this._metadataService.getRevocationEndpoint(false);\r\n\r\n        logger.debug(`got revocation endpoint, revoking ${args.token_type_hint ?? \"default token type\"}`);\r\n\r\n        const params = new URLSearchParams();\r\n        for (const [key, value] of Object.entries(args)) {\r\n            if (value != null) {\r\n                params.set(key, value);\r\n            }\r\n        }\r\n        params.set(\"client_id\", this._settings.client_id);\r\n        if (this._settings.client_secret) {\r\n            params.set(\"client_secret\", this._settings.client_secret);\r\n        }\r\n\r\n        await this._jsonService.postForm(url, { body: params });\r\n        logger.debug(\"got response\");\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, JwtUtils } from \"./utils\";\r\nimport { ErrorResponse } from \"./errors\";\r\nimport type { MetadataService } from \"./MetadataService\";\r\nimport { UserInfoService } from \"./UserInfoService\";\r\nimport { TokenClient } from \"./TokenClient\";\r\nimport type { OidcClientSettingsStore } from \"./OidcClientSettings\";\r\nimport type { SigninState } from \"./SigninState\";\r\nimport type { SigninResponse } from \"./SigninResponse\";\r\nimport type { State } from \"./State\";\r\nimport type { SignoutResponse } from \"./SignoutResponse\";\r\nimport type { UserProfile } from \"./User\";\r\nimport type { RefreshState } from \"./RefreshState\";\r\nimport type { JwtClaims, IdTokenClaims } from \"./Claims\";\r\n\r\n/**\r\n * Derived from the following sets of claims:\r\n * - {@link https://datatracker.ietf.org/doc/html/rfc7519.html#section-4.1}\r\n * - {@link https://openid.net/specs/openid-connect-core-1_0.html#IDToken}\r\n * - {@link https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken}\r\n *\r\n * @internal\r\n */\r\nconst ProtocolClaims = [\r\n    \"iss\",\r\n    // \"sub\" should never be excluded, we need access to it internally\r\n    \"aud\",\r\n    \"exp\",\r\n    \"nbf\",\r\n    \"iat\",\r\n    \"jti\",\r\n    \"auth_time\",\r\n    \"nonce\",\r\n    \"acr\",\r\n    \"amr\",\r\n    \"azp\",\r\n    // https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken\r\n    \"at_hash\",\r\n] as const;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ResponseValidator {\r\n    protected readonly _logger = new Logger(\"ResponseValidator\");\r\n    protected readonly _userInfoService = new UserInfoService(this._metadataService);\r\n    protected readonly _tokenClient = new TokenClient(this._settings, this._metadataService);\r\n\r\n    public constructor(\r\n        protected readonly _settings: OidcClientSettingsStore,\r\n        protected readonly _metadataService: MetadataService,\r\n    ) {}\r\n\r\n    public async validateSigninResponse(response: SigninResponse, state: SigninState): Promise<void> {\r\n        const logger = this._logger.create(\"validateSigninResponse\");\r\n\r\n        this._processSigninState(response, state);\r\n        logger.debug(\"state processed\");\r\n\r\n        await this._processCode(response, state);\r\n        logger.debug(\"code processed\");\r\n\r\n        if (response.isOpenId) {\r\n            this._validateIdTokenAttributes(response);\r\n        }\r\n        logger.debug(\"tokens validated\");\r\n\r\n        await this._processClaims(response, state?.skipUserInfo, response.isOpenId);\r\n        logger.debug(\"claims processed\");\r\n    }\r\n\r\n    public async validateRefreshResponse(response: SigninResponse, state: RefreshState): Promise<void> {\r\n        const logger = this._logger.create(\"validateRefreshResponse\");\r\n\r\n        response.userState = state.data;\r\n        // if there's no scope on the response, then assume all scopes granted (per-spec) and copy over scopes from original request\r\n        response.scope ??= state.scope;\r\n\r\n        // OpenID Connect Core 1.0 says that id_token is optional in refresh response:\r\n        // https://openid.net/specs/openid-connect-core-1_0.html#RefreshTokenResponse\r\n        const hasIdToken = response.isOpenId && !!response.id_token;\r\n        if (hasIdToken) {\r\n            this._validateIdTokenAttributes(response, state.id_token);\r\n            logger.debug(\"ID Token validated\");\r\n        }\r\n\r\n        await this._processClaims(response, false, hasIdToken);\r\n        logger.debug(\"claims processed\");\r\n    }\r\n\r\n    public validateSignoutResponse(response: SignoutResponse, state: State): void {\r\n        const logger = this._logger.create(\"validateSignoutResponse\");\r\n        if (state.id !== response.state) {\r\n            logger.throw(new Error(\"State does not match\"));\r\n        }\r\n\r\n        // now that we know the state matches, take the stored data\r\n        // and set it into the response so callers can get their state\r\n        // this is important for both success & error outcomes\r\n        logger.debug(\"state validated\");\r\n        response.userState = state.data;\r\n\r\n        if (response.error) {\r\n            logger.warn(\"Response was error\", response.error);\r\n            throw new ErrorResponse(response);\r\n        }\r\n    }\r\n\r\n    protected _processSigninState(response: SigninResponse, state: SigninState): void {\r\n        const logger = this._logger.create(\"_processSigninState\");\r\n        if (state.id !== response.state) {\r\n            logger.throw(new Error(\"State does not match\"));\r\n        }\r\n\r\n        if (!state.client_id) {\r\n            logger.throw(new Error(\"No client_id on state\"));\r\n        }\r\n\r\n        if (!state.authority) {\r\n            logger.throw(new Error(\"No authority on state\"));\r\n        }\r\n\r\n        // ensure we're using the correct authority\r\n        if (this._settings.authority !== state.authority) {\r\n            logger.throw(new Error(\"authority mismatch on settings vs. signin state\"));\r\n        }\r\n        if (this._settings.client_id && this._settings.client_id !== state.client_id) {\r\n            logger.throw(new Error(\"client_id mismatch on settings vs. signin state\"));\r\n        }\r\n\r\n        // now that we know the state matches, take the stored data\r\n        // and set it into the response so callers can get their state\r\n        // this is important for both success & error outcomes\r\n        logger.debug(\"state validated\");\r\n        response.userState = state.data;\r\n        // if there's no scope on the response, then assume all scopes granted (per-spec) and copy over scopes from original request\r\n        response.scope ??= state.scope;\r\n\r\n        if (response.error) {\r\n            logger.warn(\"Response was error\", response.error);\r\n            throw new ErrorResponse(response);\r\n        }\r\n\r\n        if (state.code_verifier && !response.code) {\r\n            logger.throw(new Error(\"Expected code in response\"));\r\n        }\r\n\r\n        if (!state.code_verifier && response.code) {\r\n            logger.throw(new Error(\"Unexpected code in response\"));\r\n        }\r\n    }\r\n\r\n    protected async _processClaims(response: SigninResponse, skipUserInfo = false, validateSub = true): Promise<void> {\r\n        const logger = this._logger.create(\"_processClaims\");\r\n        response.profile = this._filterProtocolClaims(response.profile);\r\n\r\n        if (skipUserInfo || !this._settings.loadUserInfo || !response.access_token) {\r\n            logger.debug(\"not loading user info\");\r\n            return;\r\n        }\r\n\r\n        logger.debug(\"loading user info\");\r\n        const claims = await this._userInfoService.getClaims(response.access_token);\r\n        logger.debug(\"user info claims received from user info endpoint\");\r\n\r\n        if (validateSub && claims.sub !== response.profile.sub) {\r\n            logger.throw(new Error(\"subject from UserInfo response does not match subject in ID Token\"));\r\n        }\r\n\r\n        response.profile = this._mergeClaims(response.profile, this._filterProtocolClaims(claims as IdTokenClaims));\r\n        logger.debug(\"user info claims received, updated profile:\", response.profile);\r\n    }\r\n\r\n    protected _mergeClaims(claims1: UserProfile, claims2: JwtClaims): UserProfile {\r\n        const result = { ...claims1 };\r\n\r\n        for (const [claim, values] of Object.entries(claims2)) {\r\n            for (const value of Array.isArray(values) ? values : [values]) {\r\n                const previousValue = result[claim];\r\n                if (!previousValue) {\r\n                    result[claim] = value;\r\n                }\r\n                else if (Array.isArray(previousValue)) {\r\n                    if (!previousValue.includes(value)) {\r\n                        previousValue.push(value);\r\n                    }\r\n                }\r\n                else if (result[claim] !== value) {\r\n                    if (typeof value === \"object\" && this._settings.mergeClaims) {\r\n                        result[claim] = this._mergeClaims(previousValue as UserProfile, value);\r\n                    }\r\n                    else {\r\n                        result[claim] = [previousValue, value];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected _filterProtocolClaims(claims: UserProfile): UserProfile {\r\n        const result = { ...claims };\r\n\r\n        if (this._settings.filterProtocolClaims) {\r\n            for (const type of ProtocolClaims) {\r\n                delete result[type];\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected async _processCode(response: SigninResponse, state: SigninState): Promise<void> {\r\n        const logger = this._logger.create(\"_processCode\");\r\n        if (response.code) {\r\n            logger.debug(\"Validating code\");\r\n            const tokenResponse = await this._tokenClient.exchangeCode({\r\n                client_id: state.client_id,\r\n                client_secret: state.client_secret,\r\n                code: response.code,\r\n                redirect_uri: state.redirect_uri,\r\n                code_verifier: state.code_verifier,\r\n                ...state.extraTokenParams,\r\n            });\r\n            Object.assign(response, tokenResponse);\r\n        } else {\r\n            logger.debug(\"No code to process\");\r\n        }\r\n    }\r\n\r\n    protected _validateIdTokenAttributes(response: SigninResponse, currentToken?: string): void {\r\n        const logger = this._logger.create(\"_validateIdTokenAttributes\");\r\n\r\n        logger.debug(\"decoding ID Token JWT\");\r\n        const profile = JwtUtils.decode(response.id_token ?? \"\");\r\n\r\n        if (!profile.sub) {\r\n            logger.throw(new Error(\"ID Token is missing a subject claim\"));\r\n        }\r\n\r\n        if (currentToken) {\r\n            const current = JwtUtils.decode(currentToken);\r\n            if (current.sub !== profile.sub) {\r\n                logger.throw(new Error(\"sub in id_token does not match current sub\"));\r\n            }\r\n            if (current.auth_time && current.auth_time !== profile.auth_time) {\r\n                logger.throw(new Error(\"auth_time in id_token does not match original auth_time\"));\r\n            }\r\n            if (current.azp && current.azp !== profile.azp) {\r\n                logger.throw(new Error(\"azp in id_token does not match original azp\"));\r\n            }\r\n            if (!current.azp && profile.azp) {\r\n                logger.throw(new Error(\"azp not in id_token, but present in original id_token\"));\r\n            }\r\n        }\r\n\r\n        response.profile = profile as UserProfile;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, CryptoUtils, Timer } from \"./utils\";\r\nimport type { StateStore } from \"./StateStore\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class State {\r\n    public readonly id: string;\r\n    public readonly created: number;\r\n    public readonly request_type: string | undefined;\r\n\r\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\r\n    public readonly data: unknown | undefined;\r\n\r\n    public constructor(args: {\r\n        id?: string;\r\n        data?: unknown;\r\n        created?: number;\r\n        request_type?: string;\r\n    }) {\r\n        this.id = args.id || CryptoUtils.generateUUIDv4();\r\n        this.data = args.data;\r\n\r\n        if (args.created && args.created > 0) {\r\n            this.created = args.created;\r\n        }\r\n        else {\r\n            this.created = Timer.getEpochTime();\r\n        }\r\n        this.request_type = args.request_type;\r\n    }\r\n\r\n    public toStorageString(): string {\r\n        new Logger(\"State\").create(\"toStorageString\");\r\n        return JSON.stringify({\r\n            id: this.id,\r\n            data: this.data,\r\n            created: this.created,\r\n            request_type: this.request_type,\r\n        });\r\n    }\r\n\r\n    public static fromStorageString(storageString: string): State {\r\n        Logger.createStatic(\"State\", \"fromStorageString\");\r\n        return new State(JSON.parse(storageString));\r\n    }\r\n\r\n    public static async clearStaleState(storage: StateStore, age: number): Promise<void> {\r\n        const logger = Logger.createStatic(\"State\", \"clearStaleState\");\r\n        const cutoff = Timer.getEpochTime() - age;\r\n\r\n        const keys = await storage.getAllKeys();\r\n        logger.debug(\"got keys\", keys);\r\n\r\n        for (let i = 0; i < keys.length; i++) {\r\n            const key = keys[i];\r\n            const item = await storage.get(key);\r\n            let remove = false;\r\n\r\n            if (item) {\r\n                try {\r\n                    const state = State.fromStorageString(item);\r\n\r\n                    logger.debug(\"got item from key:\", key, state.created);\r\n                    if (state.created <= cutoff) {\r\n                        remove = true;\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    logger.error(\"Error parsing state for key:\", key, err);\r\n                    remove = true;\r\n                }\r\n            }\r\n            else {\r\n                logger.debug(\"no item in storage for key:\", key);\r\n                remove = true;\r\n            }\r\n\r\n            if (remove) {\r\n                logger.debug(\"removed item for key:\", key);\r\n                void storage.remove(key);\r\n            }\r\n        }\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, CryptoUtils } from \"./utils\";\r\nimport { State } from \"./State\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class SigninState extends State {\r\n    // isCode\r\n    /** The same code_verifier that was used to obtain the authorization_code via PKCE. */\r\n    public readonly code_verifier: string | undefined;\r\n    /** Used to secure authorization code grants via Proof Key for Code Exchange (PKCE). */\r\n    public readonly code_challenge: string | undefined;\r\n\r\n    // to ensure state still matches settings\r\n    /** @see {@link OidcClientSettings.authority} */\r\n    public readonly authority: string;\r\n    /** @see {@link OidcClientSettings.client_id} */\r\n    public readonly client_id: string;\r\n    /** @see {@link OidcClientSettings.redirect_uri} */\r\n    public readonly redirect_uri: string;\r\n    /** @see {@link OidcClientSettings.scope} */\r\n    public readonly scope: string;\r\n    /** @see {@link OidcClientSettings.client_secret} */\r\n    public readonly client_secret: string | undefined;\r\n    /** @see {@link OidcClientSettings.extraTokenParams} */\r\n    public readonly extraTokenParams: Record<string, unknown> | undefined;\r\n    /** @see {@link OidcClientSettings.response_mode} */\r\n    public readonly response_mode: \"query\" | \"fragment\" | undefined;\r\n\r\n    public readonly skipUserInfo: boolean | undefined;\r\n\r\n    public constructor(args: {\r\n        id?: string;\r\n        data?: unknown;\r\n        created?: number;\r\n        request_type?: string;\r\n\r\n        code_verifier?: string | boolean;\r\n        authority: string;\r\n        client_id: string;\r\n        redirect_uri: string;\r\n        scope: string;\r\n        client_secret?: string;\r\n        extraTokenParams?: Record<string, unknown>;\r\n        response_mode?: \"query\" | \"fragment\";\r\n        skipUserInfo?: boolean;\r\n    }) {\r\n        super(args);\r\n\r\n        if (args.code_verifier === true) {\r\n            this.code_verifier = CryptoUtils.generateCodeVerifier();\r\n        }\r\n        else if (args.code_verifier) {\r\n            this.code_verifier = args.code_verifier;\r\n        }\r\n\r\n        if (this.code_verifier) {\r\n            this.code_challenge = CryptoUtils.generateCodeChallenge(this.code_verifier);\r\n        }\r\n\r\n        this.authority = args.authority;\r\n        this.client_id = args.client_id;\r\n        this.redirect_uri = args.redirect_uri;\r\n        this.scope = args.scope;\r\n        this.client_secret = args.client_secret;\r\n        this.extraTokenParams = args.extraTokenParams;\r\n\r\n        this.response_mode = args.response_mode;\r\n        this.skipUserInfo = args.skipUserInfo;\r\n    }\r\n\r\n    public toStorageString(): string {\r\n        new Logger(\"SigninState\").create(\"toStorageString\");\r\n        return JSON.stringify({\r\n            id: this.id,\r\n            data: this.data,\r\n            created: this.created,\r\n            request_type: this.request_type,\r\n\r\n            code_verifier: this.code_verifier,\r\n            authority: this.authority,\r\n            client_id: this.client_id,\r\n            redirect_uri: this.redirect_uri,\r\n            scope: this.scope,\r\n            client_secret: this.client_secret,\r\n            extraTokenParams : this.extraTokenParams,\r\n            response_mode: this.response_mode,\r\n            skipUserInfo: this.skipUserInfo,\r\n        });\r\n    }\r\n\r\n    public static fromStorageString(storageString: string): SigninState {\r\n        Logger.createStatic(\"SigninState\", \"fromStorageString\");\r\n        const data = JSON.parse(storageString);\r\n        return new SigninState(data);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\nimport { SigninState } from \"./SigninState\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface SigninRequestArgs {\r\n    // mandatory\r\n    url: string;\r\n    authority: string;\r\n    client_id: string;\r\n    redirect_uri: string;\r\n    response_type: string;\r\n    scope: string;\r\n\r\n    // optional\r\n    prompt?: string;\r\n    display?: string;\r\n    max_age?: number;\r\n    ui_locales?: string;\r\n    id_token_hint?: string;\r\n    login_hint?: string;\r\n    acr_values?: string;\r\n    resource?: string;\r\n    response_mode?: \"query\" | \"fragment\" ;\r\n    request?: string;\r\n    request_uri?: string;\r\n    extraQueryParams?: Record<string, string | number | boolean>;\r\n    request_type?: string;\r\n    client_secret?: string;\r\n    extraTokenParams?: Record<string, unknown>;\r\n    skipUserInfo?: boolean;\r\n    nonce?: string; \r\n\r\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\r\n    state_data?: unknown;\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport class SigninRequest {\r\n    private readonly _logger = new Logger(\"SigninRequest\");\r\n\r\n    public readonly url: string;\r\n    public readonly state: SigninState;\r\n\r\n    public constructor({\r\n        // mandatory\r\n        url, authority, client_id, redirect_uri, response_type, scope,\r\n        // optional\r\n        state_data, response_mode, request_type, client_secret, nonce,\r\n        skipUserInfo,\r\n        extraQueryParams,\r\n        extraTokenParams,\r\n        ...optionalParams\r\n    }: SigninRequestArgs) {\r\n        if (!url) {\r\n            this._logger.error(\"ctor: No url passed\");\r\n            throw new Error(\"url\");\r\n        }\r\n        if (!client_id) {\r\n            this._logger.error(\"ctor: No client_id passed\");\r\n            throw new Error(\"client_id\");\r\n        }\r\n        if (!redirect_uri) {\r\n            this._logger.error(\"ctor: No redirect_uri passed\");\r\n            throw new Error(\"redirect_uri\");\r\n        }\r\n        if (!response_type) {\r\n            this._logger.error(\"ctor: No response_type passed\");\r\n            throw new Error(\"response_type\");\r\n        }\r\n        if (!scope) {\r\n            this._logger.error(\"ctor: No scope passed\");\r\n            throw new Error(\"scope\");\r\n        }\r\n        if (!authority) {\r\n            this._logger.error(\"ctor: No authority passed\");\r\n            throw new Error(\"authority\");\r\n        }\r\n\r\n        this.state = new SigninState({\r\n            data: state_data,\r\n            request_type,\r\n            code_verifier: true,\r\n            client_id, authority, redirect_uri,\r\n            response_mode,\r\n            client_secret, scope, extraTokenParams,\r\n            skipUserInfo,\r\n        });\r\n\r\n        const parsedUrl = new URL(url);\r\n        parsedUrl.searchParams.append(\"client_id\", client_id);\r\n        parsedUrl.searchParams.append(\"redirect_uri\", redirect_uri);\r\n        parsedUrl.searchParams.append(\"response_type\", response_type);\r\n        parsedUrl.searchParams.append(\"scope\", scope);\r\n        if (nonce) {\r\n            parsedUrl.searchParams.append(\"nonce\", nonce);\r\n        }\r\n\r\n        parsedUrl.searchParams.append(\"state\", this.state.id);\r\n        if (this.state.code_challenge) {\r\n            parsedUrl.searchParams.append(\"code_challenge\", this.state.code_challenge);\r\n            parsedUrl.searchParams.append(\"code_challenge_method\", \"S256\");\r\n        }\r\n\r\n        for (const [key, value] of Object.entries({ response_mode, ...optionalParams, ...extraQueryParams })) {\r\n            if (value != null) {\r\n                parsedUrl.searchParams.append(key, value.toString());\r\n            }\r\n        }\r\n\r\n        this.url = parsedUrl.href;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Timer } from \"./utils\";\r\nimport type { UserProfile } from \"./User\";\r\n\r\nconst OidcScope = \"openid\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class SigninResponse {\r\n    // props present in the initial callback response regardless of success\r\n    public readonly state: string | null;\r\n    /** @see {@link User.session_state} */\r\n    public readonly session_state: string | null;\r\n\r\n    // error props\r\n    /** @see {@link ErrorResponse.error} */\r\n    public readonly error: string | null;\r\n    /** @see {@link ErrorResponse.error_description} */\r\n    public readonly error_description: string | null;\r\n    /** @see {@link ErrorResponse.error_uri} */\r\n    public readonly error_uri: string | null;\r\n\r\n    // success props\r\n    public readonly code: string | null;\r\n\r\n    // props set after validation\r\n    /** @see {@link User.id_token} */\r\n    public id_token?: string;\r\n    /** @see {@link User.access_token} */\r\n    public access_token = \"\";\r\n    /** @see {@link User.token_type} */\r\n    public token_type = \"\";\r\n    /** @see {@link User.refresh_token} */\r\n    public refresh_token?: string;\r\n    /** @see {@link User.scope} */\r\n    public scope?: string;\r\n    /** @see {@link User.expires_at} */\r\n    public expires_at?: number;\r\n\r\n    /** custom state data set during the initial signin request */\r\n    public userState: unknown;\r\n\r\n    /** @see {@link User.profile} */\r\n    public profile: UserProfile = {} as UserProfile;\r\n\r\n    public constructor(params: URLSearchParams) {\r\n        this.state = params.get(\"state\");\r\n        this.session_state = params.get(\"session_state\");\r\n\r\n        this.error = params.get(\"error\");\r\n        this.error_description = params.get(\"error_description\");\r\n        this.error_uri = params.get(\"error_uri\");\r\n\r\n        this.code = params.get(\"code\");\r\n    }\r\n\r\n    public get expires_in(): number | undefined {\r\n        if (this.expires_at === undefined) {\r\n            return undefined;\r\n        }\r\n        return this.expires_at - Timer.getEpochTime();\r\n    }\r\n    public set expires_in(value: number | undefined) {\r\n        // spec expects a number, but normalize here just in case\r\n        if (typeof value === \"string\") value = Number(value);\r\n        if (value !== undefined && value >= 0) {\r\n            this.expires_at = Math.floor(value) + Timer.getEpochTime();\r\n        }\r\n    }\r\n\r\n    public get isOpenId(): boolean {\r\n        return this.scope?.split(\" \").includes(OidcScope) || !!this.id_token;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\nimport { State } from \"./State\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface SignoutRequestArgs {\r\n    // mandatory\r\n    url: string;\r\n\r\n    // optional\r\n    state_data?: unknown;\r\n    id_token_hint?: string;\r\n    post_logout_redirect_uri?: string;\r\n    extraQueryParams?: Record<string, string | number | boolean>;\r\n    request_type?: string;\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport class SignoutRequest {\r\n    private readonly _logger = new Logger(\"SignoutRequest\");\r\n\r\n    public readonly url: string;\r\n    public readonly state?: State;\r\n\r\n    public constructor({\r\n        url,\r\n        state_data, id_token_hint, post_logout_redirect_uri, extraQueryParams, request_type,\r\n    }: SignoutRequestArgs) {\r\n        if (!url) {\r\n            this._logger.error(\"ctor: No url passed\");\r\n            throw new Error(\"url\");\r\n        }\r\n\r\n        const parsedUrl = new URL(url);\r\n        if (id_token_hint) {\r\n            parsedUrl.searchParams.append(\"id_token_hint\", id_token_hint);\r\n        }\r\n\r\n        if (post_logout_redirect_uri) {\r\n            parsedUrl.searchParams.append(\"post_logout_redirect_uri\", post_logout_redirect_uri);\r\n\r\n            if (state_data) {\r\n                this.state = new State({ data: state_data, request_type });\r\n\r\n                parsedUrl.searchParams.append(\"state\", this.state.id);\r\n            }\r\n        }\r\n\r\n        for (const [key, value] of Object.entries({ ...extraQueryParams })) {\r\n            if (value != null) {\r\n                parsedUrl.searchParams.append(key, value.toString());\r\n            }\r\n        }\r\n\r\n        this.url = parsedUrl.href;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\n/**\r\n * @public\r\n */\r\nexport class SignoutResponse {\r\n    public readonly state: string | null;\r\n\r\n    // error props\r\n    /** @see {@link ErrorResponse.error} */\r\n    public error: string | null;\r\n    /** @see {@link ErrorResponse.error_description} */\r\n    public error_description: string | null;\r\n    /** @see {@link ErrorResponse.error_uri} */\r\n    public error_uri: string | null;\r\n\r\n    /** custom state data set during the initial signin request */\r\n    public userState: unknown;\r\n\r\n    public constructor(params: URLSearchParams) {\r\n        this.state = params.get(\"state\");\r\n\r\n        this.error = params.get(\"error\");\r\n        this.error_description = params.get(\"error_description\");\r\n        this.error_uri = params.get(\"error_uri\");\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, UrlUtils } from \"./utils\";\r\nimport { ErrorResponse } from \"./errors\";\r\nimport { OidcClientSettings, OidcClientSettingsStore } from \"./OidcClientSettings\";\r\nimport { ResponseValidator } from \"./ResponseValidator\";\r\nimport { MetadataService } from \"./MetadataService\";\r\nimport type { RefreshState } from \"./RefreshState\";\r\nimport { SigninRequest } from \"./SigninRequest\";\r\nimport { SigninResponse } from \"./SigninResponse\";\r\nimport { SignoutRequest, SignoutRequestArgs } from \"./SignoutRequest\";\r\nimport { SignoutResponse } from \"./SignoutResponse\";\r\nimport { SigninState } from \"./SigninState\";\r\nimport { State } from \"./State\";\r\nimport { TokenClient } from \"./TokenClient\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface CreateSigninRequestArgs {\r\n    redirect_uri?: string;\r\n    response_type?: string;\r\n    scope?: string;\r\n    nonce?: string;\r\n\r\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\r\n    state?: unknown;\r\n\r\n    prompt?: string;\r\n    display?: string;\r\n    max_age?: number;\r\n    ui_locales?: string;\r\n    id_token_hint?: string;\r\n    login_hint?: string;\r\n    acr_values?: string;\r\n    resource?: string;\r\n    response_mode?: \"query\" | \"fragment\";\r\n    request?: string;\r\n    request_uri?: string;\r\n    extraQueryParams?: Record<string, string | number | boolean>;\r\n    request_type?: string;\r\n    client_secret?: string;\r\n    extraTokenParams?: Record<string, unknown>;\r\n    skipUserInfo?: boolean;\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface UseRefreshTokenArgs {\r\n    state: RefreshState;\r\n    timeoutInSeconds?: number;\r\n    customRequestArgs: object;\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport type CreateSignoutRequestArgs = Omit<SignoutRequestArgs, \"url\" | \"state_data\"> & { state?: unknown };\r\n\r\n/**\r\n * Provides the raw OIDC/OAuth2 protocol support for the authorization endpoint and the end session endpoint in the\r\n * authorization server. It provides a bare-bones protocol implementation and is used by the UserManager class.\r\n * Only use this class if you simply want protocol support without the additional management features of the\r\n * UserManager class.\r\n *\r\n * @public\r\n */\r\nexport class OidcClient {\r\n    public readonly settings: OidcClientSettingsStore;\r\n    protected readonly _logger = new Logger(\"OidcClient\");\r\n\r\n    public readonly metadataService: MetadataService;\r\n    protected readonly _validator: ResponseValidator;\r\n    protected readonly _tokenClient: TokenClient;\r\n\r\n    public constructor(settings: OidcClientSettings) {\r\n        this.settings = new OidcClientSettingsStore(settings);\r\n\r\n        this.metadataService = new MetadataService(this.settings);\r\n        this._validator = new ResponseValidator(this.settings, this.metadataService);\r\n        this._tokenClient = new TokenClient(this.settings, this.metadataService);\r\n    }\r\n\r\n    public async createSigninRequest({\r\n        state,\r\n        request,\r\n        request_uri,\r\n        request_type,\r\n        id_token_hint,\r\n        login_hint,\r\n        skipUserInfo,\r\n        nonce, \r\n        response_type = this.settings.response_type,\r\n        scope = this.settings.scope,\r\n        redirect_uri = this.settings.redirect_uri,\r\n        prompt = this.settings.prompt,\r\n        display = this.settings.display,\r\n        max_age = this.settings.max_age,\r\n        ui_locales = this.settings.ui_locales,\r\n        acr_values = this.settings.acr_values,\r\n        resource = this.settings.resource,\r\n        response_mode = this.settings.response_mode,\r\n        extraQueryParams = this.settings.extraQueryParams,\r\n        extraTokenParams = this.settings.extraTokenParams,\r\n    }: CreateSigninRequestArgs): Promise<SigninRequest> {\r\n        const logger = this._logger.create(\"createSigninRequest\");\r\n\r\n        if (response_type !== \"code\") {\r\n            throw new Error(\"Only the Authorization Code flow (with PKCE) is supported\");\r\n        }\r\n\r\n        const url = await this.metadataService.getAuthorizationEndpoint();\r\n        logger.debug(\"Received authorization endpoint\", url);\r\n\r\n        const signinRequest = new SigninRequest({\r\n            url,\r\n            authority: this.settings.authority,\r\n            client_id: this.settings.client_id,\r\n            redirect_uri,\r\n            response_type,\r\n            scope,\r\n            state_data: state,\r\n            prompt, display, max_age, ui_locales, id_token_hint, login_hint, acr_values,\r\n            resource, request, request_uri, extraQueryParams, extraTokenParams, request_type, response_mode,\r\n            client_secret: this.settings.client_secret,\r\n            skipUserInfo,\r\n            nonce,\r\n        });\r\n\r\n        const signinState = signinRequest.state;\r\n        await this.settings.stateStore.set(signinState.id, signinState.toStorageString());\r\n        return signinRequest;\r\n    }\r\n\r\n    public async readSigninResponseState(url: string, removeState = false): Promise<{ state: SigninState; response: SigninResponse }> {\r\n        const logger = this._logger.create(\"readSigninResponseState\");\r\n\r\n        const response = new SigninResponse(UrlUtils.readParams(url, this.settings.response_mode));\r\n        if (!response.state) {\r\n            logger.throw(new Error(\"No state in response\"));\r\n            // need to throw within this function's body for type narrowing to work\r\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n        }\r\n\r\n        const storedStateString = await this.settings.stateStore[removeState ? \"remove\" : \"get\"](response.state);\r\n        if (!storedStateString) {\r\n            logger.throw(new Error(\"No matching state found in storage\"));\r\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n        }\r\n\r\n        const state = SigninState.fromStorageString(storedStateString);\r\n        return { state, response };\r\n    }\r\n\r\n    public async processSigninResponse(url: string): Promise<SigninResponse> {\r\n        const logger = this._logger.create(\"processSigninResponse\");\r\n\r\n        const { state, response } = await this.readSigninResponseState(url, true);\r\n        logger.debug(\"received state from storage; validating response\");\r\n        await this._validator.validateSigninResponse(response, state);\r\n        return response;\r\n    }\r\n\r\n    public async useRefreshToken({\r\n        state,\r\n        timeoutInSeconds,\r\n        customRequestArgs = {},\r\n    }: UseRefreshTokenArgs): Promise<SigninResponse> {\r\n        const logger = this._logger.create(\"useRefreshToken\");\r\n\r\n        const result = await this._tokenClient.exchangeRefreshToken({\r\n            refresh_token: state.refresh_token,\r\n            scope: state.scope,\r\n            timeoutInSeconds,\r\n            ...customRequestArgs,\r\n        });\r\n        const response = new SigninResponse(new URLSearchParams());\r\n        Object.assign(response, result);\r\n        logger.debug(\"validating response\", response);\r\n        await this._validator.validateRefreshResponse(response, state);\r\n        return response;\r\n    }\r\n\r\n    public async createSignoutRequest({\r\n        state,\r\n        id_token_hint,\r\n        request_type,\r\n        post_logout_redirect_uri = this.settings.post_logout_redirect_uri,\r\n        extraQueryParams = this.settings.extraQueryParams,\r\n    }: CreateSignoutRequestArgs = {}): Promise<SignoutRequest> {\r\n        const logger = this._logger.create(\"createSignoutRequest\");\r\n\r\n        const url = await this.metadataService.getEndSessionEndpoint();\r\n        if (!url) {\r\n            logger.throw(new Error(\"No end session endpoint\"));\r\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n        }\r\n\r\n        logger.debug(\"Received end session endpoint\", url);\r\n\r\n        const request = new SignoutRequest({\r\n            url,\r\n            id_token_hint,\r\n            post_logout_redirect_uri,\r\n            state_data: state,\r\n            extraQueryParams,\r\n            request_type,\r\n        });\r\n\r\n        const signoutState = request.state;\r\n        if (signoutState) {\r\n            logger.debug(\"Signout request has state to persist\");\r\n            await this.settings.stateStore.set(signoutState.id, signoutState.toStorageString());\r\n        }\r\n\r\n        return request;\r\n    }\r\n\r\n    public async readSignoutResponseState(url: string, removeState = false): Promise<{ state: State | undefined; response: SignoutResponse }> {\r\n        const logger = this._logger.create(\"readSignoutResponseState\");\r\n\r\n        const response = new SignoutResponse(UrlUtils.readParams(url, this.settings.response_mode));\r\n        if (!response.state) {\r\n            logger.debug(\"No state in response\");\r\n\r\n            if (response.error) {\r\n                logger.warn(\"Response was error:\", response.error);\r\n                throw new ErrorResponse(response);\r\n            }\r\n\r\n            return { state: undefined, response };\r\n        }\r\n\r\n        const storedStateString = await this.settings.stateStore[removeState ? \"remove\" : \"get\"](response.state);\r\n        if (!storedStateString) {\r\n            logger.throw(new Error(\"No matching state found in storage\"));\r\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\r\n        }\r\n\r\n        const state = State.fromStorageString(storedStateString);\r\n        return { state, response };\r\n    }\r\n\r\n    public async processSignoutResponse(url: string): Promise<SignoutResponse> {\r\n        const logger = this._logger.create(\"processSignoutResponse\");\r\n\r\n        const { state, response } = await this.readSignoutResponseState(url, true);\r\n        if (state) {\r\n            logger.debug(\"Received state from storage; validating response\");\r\n            this._validator.validateSignoutResponse(response, state);\r\n        } else {\r\n            logger.debug(\"No state from storage; skipping response validation\");\r\n        }\r\n\r\n        return response;\r\n    }\r\n\r\n    public clearStaleState(): Promise<void> {\r\n        this._logger.create(\"clearStaleState\");\r\n        return State.clearStaleState(this.settings.stateStore, this.settings.staleStateAgeInSeconds);\r\n    }\r\n\r\n    public async revokeToken(token: string, type?: \"access_token\" | \"refresh_token\"): Promise<void> {\r\n        this._logger.create(\"revokeToken\");\r\n        return await this._tokenClient.revoke({\r\n            token,\r\n            token_type_hint: type,\r\n        });\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\nimport { CheckSessionIFrame } from \"./CheckSessionIFrame\";\r\nimport type { UserManager } from \"./UserManager\";\r\nimport type { User } from \"./User\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class SessionMonitor {\r\n    private readonly _logger = new Logger(\"SessionMonitor\");\r\n\r\n    private _sub: string | undefined;\r\n    private _sid: string | undefined;\r\n    private _checkSessionIFrame?: CheckSessionIFrame;\r\n\r\n    public constructor(private readonly _userManager: UserManager) {\r\n        if (!_userManager) {\r\n            this._logger.throw(new Error(\"No user manager passed\"));\r\n        }\r\n\r\n        this._userManager.events.addUserLoaded(this._start);\r\n        this._userManager.events.addUserUnloaded(this._stop);\r\n\r\n        this._init().catch((err: unknown) => {\r\n            // catch to suppress errors since we're in a ctor\r\n            this._logger.error(err);\r\n        });\r\n    }\r\n\r\n    protected async _init(): Promise<void> {\r\n        this._logger.create(\"_init\");\r\n        const user = await this._userManager.getUser();\r\n        // doing this manually here since calling getUser\r\n        // doesn't trigger load event.\r\n        if (user) {\r\n            void this._start(user);\r\n        }\r\n        else if (this._userManager.settings.monitorAnonymousSession) {\r\n            const session = await this._userManager.querySessionStatus();\r\n            if (session) {\r\n                const tmpUser = {\r\n                    session_state: session.session_state,\r\n                    profile: session.sub && session.sid ? {\r\n                        sub: session.sub,\r\n                        sid: session.sid,\r\n                    } : null,\r\n                };\r\n                void this._start(tmpUser);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _start = async (\r\n        user: User | {\r\n            session_state: string;\r\n            profile: { sub: string; sid: string } | null;\r\n        },\r\n    ): Promise<void> => {\r\n        const session_state = user.session_state;\r\n        if (!session_state) {\r\n            return;\r\n        }\r\n        const logger = this._logger.create(\"_start\");\r\n\r\n        if (user.profile) {\r\n            this._sub = user.profile.sub;\r\n            this._sid = user.profile.sid;\r\n            logger.debug(\"session_state\", session_state, \", sub\", this._sub);\r\n        }\r\n        else {\r\n            this._sub = undefined;\r\n            this._sid = undefined;\r\n            logger.debug(\"session_state\", session_state, \", anonymous user\");\r\n        }\r\n\r\n        if (this._checkSessionIFrame) {\r\n            this._checkSessionIFrame.start(session_state);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = await this._userManager.metadataService.getCheckSessionIframe();\r\n            if (url) {\r\n                logger.debug(\"initializing check session iframe\");\r\n\r\n                const client_id = this._userManager.settings.client_id;\r\n                const intervalInSeconds = this._userManager.settings.checkSessionIntervalInSeconds;\r\n                const stopOnError = this._userManager.settings.stopCheckSessionOnError;\r\n\r\n                const checkSessionIFrame = new CheckSessionIFrame(this._callback, client_id, url, intervalInSeconds, stopOnError);\r\n                await checkSessionIFrame.load();\r\n                this._checkSessionIFrame = checkSessionIFrame;\r\n                checkSessionIFrame.start(session_state);\r\n            }\r\n            else {\r\n                logger.warn(\"no check session iframe found in the metadata\");\r\n            }\r\n        }\r\n        catch (err) {\r\n            // catch to suppress errors since we're in non-promise callback\r\n            logger.error(\"Error from getCheckSessionIframe:\", err instanceof Error ? err.message : err);\r\n        }\r\n    };\r\n\r\n    protected _stop = (): void => {\r\n        const logger = this._logger.create(\"_stop\");\r\n        this._sub = undefined;\r\n        this._sid = undefined;\r\n\r\n        if (this._checkSessionIFrame) {\r\n            this._checkSessionIFrame.stop();\r\n        }\r\n\r\n        if (this._userManager.settings.monitorAnonymousSession) {\r\n            // using a timer to delay re-initialization to avoid race conditions during signout\r\n            // TODO rewrite to use promise correctly\r\n            // eslint-disable-next-line @typescript-eslint/no-misused-promises\r\n            const timerHandle = setInterval(async () => {\r\n                clearInterval(timerHandle);\r\n\r\n                try {\r\n                    const session = await this._userManager.querySessionStatus();\r\n                    if (session) {\r\n                        const tmpUser = {\r\n                            session_state: session.session_state,\r\n                            profile: session.sub && session.sid ? {\r\n                                sub: session.sub,\r\n                                sid: session.sid,\r\n                            } : null,\r\n                        };\r\n                        void this._start(tmpUser);\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    // catch to suppress errors since we're in a callback\r\n                    logger.error(\"error from querySessionStatus\", err instanceof Error ? err.message : err);\r\n                }\r\n            }, 1000);\r\n        }\r\n    };\r\n\r\n    protected _callback = async (): Promise<void> => {\r\n        const logger = this._logger.create(\"_callback\");\r\n        try {\r\n            const session = await this._userManager.querySessionStatus();\r\n            let raiseEvent = true;\r\n\r\n            if (session && this._checkSessionIFrame) {\r\n                if (session.sub === this._sub) {\r\n                    raiseEvent = false;\r\n                    this._checkSessionIFrame.start(session.session_state);\r\n\r\n                    if (session.sid === this._sid) {\r\n                        logger.debug(\"same sub still logged in at OP, restarting check session iframe; session_state\", session.session_state);\r\n                    }\r\n                    else {\r\n                        logger.debug(\"same sub still logged in at OP, session state has changed, restarting check session iframe; session_state\", session.session_state);\r\n                        this._userManager.events._raiseUserSessionChanged();\r\n                    }\r\n                }\r\n                else {\r\n                    logger.debug(\"different subject signed into OP\", session.sub);\r\n                }\r\n            }\r\n            else {\r\n                logger.debug(\"subject no longer signed into OP\");\r\n            }\r\n\r\n            if (raiseEvent) {\r\n                if (this._sub) {\r\n                    this._userManager.events._raiseUserSignedOut();\r\n                }\r\n                else {\r\n                    this._userManager.events._raiseUserSignedIn();\r\n                }\r\n            } else {\r\n                logger.debug(\"no change in session detected, no event to raise\");\r\n            }\r\n        }\r\n        catch (err) {\r\n            if (this._sub) {\r\n                logger.debug(\"Error calling queryCurrentSigninSession; raising signed out event\", err);\r\n                this._userManager.events._raiseUserSignedOut();\r\n            }\r\n        }\r\n    };\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, Timer } from \"./utils\";\r\nimport type { IdTokenClaims } from \"./Claims\";\r\n\r\n/**\r\n * Holds claims represented by a combination of the `id_token` and the user info endpoint.\r\n * @public\r\n */\r\nexport type UserProfile = IdTokenClaims;\r\n\r\n/**\r\n * @public\r\n */\r\nexport class User {\r\n    /**\r\n     * A JSON Web Token (JWT). Only provided if `openid` scope was requested.\r\n     * The application can access the data decoded by using the `profile` property.\r\n     */\r\n    public id_token?: string;\r\n\r\n    /** The session state value returned from the OIDC provider. */\r\n    public session_state: string | null;\r\n\r\n    /**\r\n     * The requested access token returned from the OIDC provider. The application can use this token to\r\n     * authenticate itself to the secured resource.\r\n     */\r\n    public access_token: string;\r\n\r\n    /**\r\n     * An OAuth 2.0 refresh token. The app can use this token to acquire additional access tokens after the\r\n     * current access token expires. Refresh tokens are long-lived and can be used to maintain access to resources\r\n     * for extended periods of time.\r\n     */\r\n    public refresh_token?: string;\r\n\r\n    /** Typically \"Bearer\" */\r\n    public token_type: string;\r\n\r\n    /** The scopes that the requested access token is valid for. */\r\n    public scope?: string;\r\n\r\n    /** The claims represented by a combination of the `id_token` and the user info endpoint. */\r\n    public profile: UserProfile;\r\n\r\n    /** The expires at returned from the OIDC provider. */\r\n    public expires_at?: number;\r\n\r\n    /** custom state data set during the initial signin request */\r\n    public readonly state: unknown;\r\n\r\n    public constructor(args: {\r\n        id_token?: string;\r\n        session_state?: string | null;\r\n        access_token: string;\r\n        refresh_token?: string;\r\n        token_type: string;\r\n        scope?: string;\r\n        profile: UserProfile;\r\n        expires_at?: number;\r\n        userState?: unknown;\r\n    }) {\r\n        this.id_token = args.id_token;\r\n        this.session_state = args.session_state ?? null;\r\n        this.access_token = args.access_token;\r\n        this.refresh_token = args.refresh_token;\r\n\r\n        this.token_type = args.token_type;\r\n        this.scope = args.scope;\r\n        this.profile = args.profile;\r\n        this.expires_at = args.expires_at;\r\n        this.state = args.userState;\r\n    }\r\n\r\n    /** Computed number of seconds the access token has remaining. */\r\n    public get expires_in(): number | undefined {\r\n        if (this.expires_at === undefined) {\r\n            return undefined;\r\n        }\r\n        return this.expires_at - Timer.getEpochTime();\r\n    }\r\n\r\n    public set expires_in(value: number | undefined) {\r\n        if (value !== undefined) {\r\n            this.expires_at = Math.floor(value) + Timer.getEpochTime();\r\n        }\r\n    }\r\n\r\n    /** Computed value indicating if the access token is expired. */\r\n    public get expired(): boolean | undefined {\r\n        const expires_in = this.expires_in;\r\n        if (expires_in === undefined) {\r\n            return undefined;\r\n        }\r\n        return expires_in <= 0;\r\n    }\r\n\r\n    /** Array representing the parsed values from the `scope`. */\r\n    public get scopes(): string[] {\r\n        return this.scope?.split(\" \") ?? [];\r\n    }\r\n\r\n    public toStorageString(): string {\r\n        new Logger(\"User\").create(\"toStorageString\");\r\n        return JSON.stringify({\r\n            id_token: this.id_token,\r\n            session_state: this.session_state,\r\n            access_token: this.access_token,\r\n            refresh_token: this.refresh_token,\r\n            token_type: this.token_type,\r\n            scope: this.scope,\r\n            profile: this.profile,\r\n            expires_at: this.expires_at,\r\n        });\r\n    }\r\n\r\n    public static fromStorageString(storageString: string): User {\r\n        Logger.createStatic(\"User\", \"fromStorageString\");\r\n        return new User(JSON.parse(storageString));\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Event, Logger, UrlUtils } from \"../utils\";\r\nimport type { IWindow, NavigateParams, NavigateResponse } from \"./IWindow\";\r\n\r\nconst messageSource = \"oidc-client\";\r\n\r\ninterface MessageData {\r\n    source: string;\r\n    url: string;\r\n    keepOpen: boolean;\r\n}\r\n\r\n/**\r\n * Window implementation which resolves via communication from a child window\r\n * via the `Window.postMessage()` interface.\r\n *\r\n * @internal\r\n */\r\nexport abstract class AbstractChildWindow implements IWindow {\r\n    protected abstract readonly _logger: Logger;\r\n    protected readonly _abort = new Event<[reason: Error]>(\"Window navigation aborted\");\r\n    protected readonly _disposeHandlers = new Set<() => void>();\r\n\r\n    protected _window: WindowProxy | null = null;\r\n\r\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\r\n        const logger = this._logger.create(\"navigate\");\r\n        if (!this._window) {\r\n            throw new Error(\"Attempted to navigate on a disposed window\");\r\n        }\r\n\r\n        logger.debug(\"setting URL in window\");\r\n        this._window.location.replace(params.url);\r\n\r\n        const { url, keepOpen } = await new Promise<MessageData>((resolve, reject) => {\r\n            const listener = (e: MessageEvent) => {\r\n                const data: MessageData | undefined = e.data;\r\n                if (e.origin !== window.location.origin || data?.source !== messageSource) {\r\n                    // silently discard events not intended for us\r\n                    return;\r\n                }\r\n                try {\r\n                    const state = UrlUtils.readParams(data.url, params.response_mode).get(\"state\");\r\n                    if (!state) {\r\n                        logger.warn(\"no state found in response url\");\r\n                    }\r\n                    if (e.source !== this._window && state !== params.state) {\r\n                        // MessageEvent source is a relatively modern feature, we can't rely on it\r\n                        // so we also inspect the payload for a matching state key as an alternative\r\n                        return;\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    this._dispose();\r\n                    reject(new Error(\"Invalid response from window\"));\r\n                }\r\n                resolve(data);\r\n            };\r\n            window.addEventListener(\"message\", listener, false);\r\n            this._disposeHandlers.add(() => window.removeEventListener(\"message\", listener, false));\r\n            this._disposeHandlers.add(this._abort.addHandler((reason) => {\r\n                this._dispose();\r\n                reject(reason);\r\n            }));\r\n        });\r\n        logger.debug(\"got response from window\");\r\n        this._dispose();\r\n\r\n        if (!keepOpen) {\r\n            this.close();\r\n        }\r\n\r\n        return { url };\r\n    }\r\n\r\n    public abstract close(): void;\r\n\r\n    private _dispose(): void {\r\n        this._logger.create(\"_dispose\");\r\n\r\n        for (const dispose of this._disposeHandlers) {\r\n            dispose();\r\n        }\r\n        this._disposeHandlers.clear();\r\n    }\r\n\r\n    protected static _notifyParent(parent: Window, url: string, keepOpen = false): void {\r\n        parent.postMessage({\r\n            source: messageSource,\r\n            url,\r\n            keepOpen,\r\n        } as MessageData, window.location.origin);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { OidcClientSettings, OidcClientSettingsStore } from \"./OidcClientSettings\";\r\nimport type { PopupWindowFeatures } from \"./utils/PopupUtils\";\r\nimport { WebStorageStateStore } from \"./WebStorageStateStore\";\r\nimport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\r\n\r\nexport const DefaultPopupWindowFeatures: PopupWindowFeatures = {\r\n    location: false,\r\n    toolbar: false,\r\n    height: 640,\r\n};\r\nexport const DefaultPopupTarget = \"_blank\";\r\nconst DefaultAccessTokenExpiringNotificationTimeInSeconds = 60;\r\nconst DefaultCheckSessionIntervalInSeconds = 2;\r\nexport const DefaultSilentRequestTimeoutInSeconds = 10;\r\n\r\n/**\r\n * The settings used to configure the {@link UserManager}.\r\n *\r\n * @public\r\n */\r\nexport interface UserManagerSettings extends OidcClientSettings {\r\n    /** The URL for the page containing the call to signinPopupCallback to handle the callback from the OIDC/OAuth2 */\r\n    popup_redirect_uri?: string;\r\n    popup_post_logout_redirect_uri?: string;\r\n    /**\r\n     * The features parameter to window.open for the popup signin window. By default, the popup is\r\n     * placed centered in front of the window opener.\r\n     * (default: \\{ location: false, menubar: false, height: 640 \\})\r\n     */\r\n    popupWindowFeatures?: PopupWindowFeatures;\r\n    /** The target parameter to window.open for the popup signin window (default: \"_blank\") */\r\n    popupWindowTarget?: string;\r\n    /** The methods window.location method used to redirect (default: \"assign\") */\r\n    redirectMethod?: \"replace\" | \"assign\";\r\n\r\n    /** The URL for the page containing the code handling the silent renew */\r\n    silent_redirect_uri?: string;\r\n    /** Number of seconds to wait for the silent renew to return before assuming it has failed or timed out (default: 10) */\r\n    silentRequestTimeoutInSeconds?: number;\r\n    /** Flag to indicate if there should be an automatic attempt to renew the access token prior to its expiration (default: true) */\r\n    automaticSilentRenew?: boolean;\r\n    /** Flag to validate user.profile.sub in silent renew calls (default: true) */\r\n    validateSubOnSilentRenew?: boolean;\r\n    /** Flag to control if id_token is included as id_token_hint in silent renew calls (default: false) */\r\n    includeIdTokenInSilentRenew?: boolean;\r\n\r\n    /** Will raise events for when user has performed a signout at the OP (default: false) */\r\n    monitorSession?: boolean;\r\n    monitorAnonymousSession?: boolean;\r\n    /** Interval in seconds to check the user's session (default: 2) */\r\n    checkSessionIntervalInSeconds?: number;\r\n    query_status_response_type?: string;\r\n    stopCheckSessionOnError?: boolean;\r\n\r\n    /**\r\n     * The `token_type_hint`s to pass to the authority server by default (default: [\"access_token\", \"refresh_token\"])\r\n     *\r\n     * Token types will be revoked in the same order as they are given here.\r\n     */\r\n    revokeTokenTypes?: (\"access_token\" | \"refresh_token\")[];\r\n    /** Will invoke the revocation endpoint on signout if there is an access token for the user (default: false) */\r\n    revokeTokensOnSignout?: boolean;\r\n    /** The number of seconds before an access token is to expire to raise the accessTokenExpiring event (default: 60) */\r\n    accessTokenExpiringNotificationTimeInSeconds?: number;\r\n\r\n    /**\r\n     * Storage object used to persist User for currently authenticated user (default: window.sessionStorage, InMemoryWebStorage iff no window).\r\n     *  E.g. `userStore: new WebStorageStateStore({ store: window.localStorage })`\r\n     */\r\n    userStore?: WebStorageStateStore;\r\n}\r\n\r\n/**\r\n * The settings with defaults applied of the {@link UserManager}.\r\n * @see {@link UserManagerSettings}\r\n *\r\n * @public\r\n */\r\nexport class UserManagerSettingsStore extends OidcClientSettingsStore {\r\n    public readonly popup_redirect_uri: string;\r\n    public readonly popup_post_logout_redirect_uri: string | undefined;\r\n    public readonly popupWindowFeatures: PopupWindowFeatures;\r\n    public readonly popupWindowTarget: string;\r\n    public readonly redirectMethod: \"replace\" | \"assign\";\r\n\r\n    public readonly silent_redirect_uri: string;\r\n    public readonly silentRequestTimeoutInSeconds: number;\r\n    public readonly automaticSilentRenew: boolean;\r\n    public readonly validateSubOnSilentRenew: boolean;\r\n    public readonly includeIdTokenInSilentRenew: boolean;\r\n\r\n    public readonly monitorSession: boolean;\r\n    public readonly monitorAnonymousSession: boolean;\r\n    public readonly checkSessionIntervalInSeconds: number;\r\n    public readonly query_status_response_type: string;\r\n    public readonly stopCheckSessionOnError: boolean;\r\n\r\n    public readonly revokeTokenTypes: (\"access_token\" | \"refresh_token\")[];\r\n    public readonly revokeTokensOnSignout: boolean;\r\n    public readonly accessTokenExpiringNotificationTimeInSeconds: number;\r\n\r\n    public readonly userStore: WebStorageStateStore;\r\n\r\n    public constructor(args: UserManagerSettings) {\r\n        const {\r\n            popup_redirect_uri = args.redirect_uri,\r\n            popup_post_logout_redirect_uri = args.post_logout_redirect_uri,\r\n            popupWindowFeatures = DefaultPopupWindowFeatures,\r\n            popupWindowTarget = DefaultPopupTarget,\r\n            redirectMethod = \"assign\",\r\n\r\n            silent_redirect_uri = args.redirect_uri,\r\n            silentRequestTimeoutInSeconds = DefaultSilentRequestTimeoutInSeconds,\r\n            automaticSilentRenew = true,\r\n            validateSubOnSilentRenew = true,\r\n            includeIdTokenInSilentRenew = false,\r\n\r\n            monitorSession = false,\r\n            monitorAnonymousSession = false,\r\n            checkSessionIntervalInSeconds = DefaultCheckSessionIntervalInSeconds,\r\n            query_status_response_type = \"code\",\r\n            stopCheckSessionOnError = true,\r\n\r\n            revokeTokenTypes = [\"access_token\", \"refresh_token\"],\r\n            revokeTokensOnSignout = false,\r\n            accessTokenExpiringNotificationTimeInSeconds = DefaultAccessTokenExpiringNotificationTimeInSeconds,\r\n\r\n            userStore,\r\n        } = args;\r\n\r\n        super(args);\r\n\r\n        this.popup_redirect_uri = popup_redirect_uri;\r\n        this.popup_post_logout_redirect_uri = popup_post_logout_redirect_uri;\r\n        this.popupWindowFeatures = popupWindowFeatures;\r\n        this.popupWindowTarget = popupWindowTarget;\r\n        this.redirectMethod = redirectMethod;\r\n\r\n        this.silent_redirect_uri = silent_redirect_uri;\r\n        this.silentRequestTimeoutInSeconds = silentRequestTimeoutInSeconds;\r\n        this.automaticSilentRenew = automaticSilentRenew;\r\n        this.validateSubOnSilentRenew = validateSubOnSilentRenew;\r\n        this.includeIdTokenInSilentRenew = includeIdTokenInSilentRenew;\r\n\r\n        this.monitorSession = monitorSession;\r\n        this.monitorAnonymousSession = monitorAnonymousSession;\r\n        this.checkSessionIntervalInSeconds = checkSessionIntervalInSeconds;\r\n        this.stopCheckSessionOnError = stopCheckSessionOnError;\r\n        this.query_status_response_type = query_status_response_type;\r\n\r\n        this.revokeTokenTypes = revokeTokenTypes;\r\n        this.revokeTokensOnSignout = revokeTokensOnSignout;\r\n        this.accessTokenExpiringNotificationTimeInSeconds = accessTokenExpiringNotificationTimeInSeconds;\r\n\r\n        if (userStore) {\r\n            this.userStore = userStore;\r\n        }\r\n        else {\r\n            const store = typeof window !== \"undefined\" ? window.sessionStorage : new InMemoryWebStorage();\r\n            this.userStore = new WebStorageStateStore({ store });\r\n        }\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"../utils\";\r\nimport { ErrorTimeout } from \"../errors\";\r\nimport type { NavigateParams, NavigateResponse } from \"./IWindow\";\r\nimport { AbstractChildWindow } from \"./AbstractChildWindow\";\r\nimport { DefaultSilentRequestTimeoutInSeconds } from \"../UserManagerSettings\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface IFrameWindowParams {\r\n    silentRequestTimeoutInSeconds?: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class IFrameWindow extends AbstractChildWindow {\r\n    protected readonly _logger = new Logger(\"IFrameWindow\");\r\n    private _frame: HTMLIFrameElement | null;\r\n    private _timeoutInSeconds: number;\r\n\r\n    public constructor({\r\n        silentRequestTimeoutInSeconds = DefaultSilentRequestTimeoutInSeconds,\r\n    }: IFrameWindowParams) {\r\n        super();\r\n        this._timeoutInSeconds = silentRequestTimeoutInSeconds;\r\n\r\n        this._frame = IFrameWindow.createHiddenIframe();\r\n        this._window = this._frame.contentWindow;\r\n    }\r\n\r\n    private static createHiddenIframe(): HTMLIFrameElement {\r\n        const iframe = window.document.createElement(\"iframe\");\r\n\r\n        // shotgun approach\r\n        iframe.style.visibility = \"hidden\";\r\n        iframe.style.position = \"fixed\";\r\n        iframe.style.left = \"-1000px\";\r\n        iframe.style.top = \"0\";\r\n        iframe.width = \"0\";\r\n        iframe.height = \"0\";\r\n        iframe.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin allow-forms\");\r\n\r\n        window.document.body.appendChild(iframe);\r\n        return iframe;\r\n    }\r\n\r\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\r\n        this._logger.debug(\"navigate: Using timeout of:\", this._timeoutInSeconds);\r\n        const timer = setTimeout(() => this._abort.raise(new ErrorTimeout(\"IFrame timed out without a response\")), this._timeoutInSeconds * 1000);\r\n        this._disposeHandlers.add(() => clearTimeout(timer));\r\n\r\n        return await super.navigate(params);\r\n    }\r\n\r\n    public close(): void {\r\n        if (this._frame) {\r\n            if (this._frame.parentNode) {\r\n                this._frame.addEventListener(\"load\", (ev) => {\r\n                    const frame = ev.target as HTMLIFrameElement;\r\n                    frame.parentNode?.removeChild(frame);\r\n                    this._abort.raise(new Error(\"IFrame removed from DOM\"));\r\n                }, true);\r\n                this._frame.contentWindow?.location.replace(\"about:blank\");\r\n            }\r\n            this._frame = null;\r\n        }\r\n        this._window = null;\r\n    }\r\n\r\n    public static notifyParent(url: string): void {\r\n        return super._notifyParent(window.parent, url);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"../utils\";\r\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\r\nimport { IFrameWindow, IFrameWindowParams } from \"./IFrameWindow\";\r\nimport type { INavigator } from \"./INavigator\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class IFrameNavigator implements INavigator {\r\n    private readonly _logger = new Logger(\"IFrameNavigator\");\r\n\r\n    constructor(private _settings: UserManagerSettingsStore) {}\r\n\r\n    public async prepare({\r\n        silentRequestTimeoutInSeconds = this._settings.silentRequestTimeoutInSeconds,\r\n    }: IFrameWindowParams): Promise<IFrameWindow> {\r\n        return new IFrameWindow({ silentRequestTimeoutInSeconds });\r\n    }\r\n\r\n    public async callback(url: string): Promise<void> {\r\n        this._logger.create(\"callback\");\r\n        IFrameWindow.notifyParent(url);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, PopupUtils, PopupWindowFeatures } from \"../utils\";\r\nimport { DefaultPopupWindowFeatures, DefaultPopupTarget } from \"../UserManagerSettings\";\r\nimport { AbstractChildWindow } from \"./AbstractChildWindow\";\r\nimport type { NavigateParams, NavigateResponse } from \"./IWindow\";\r\n\r\nconst checkForPopupClosedInterval = 500;\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface PopupWindowParams {\r\n    popupWindowFeatures?: PopupWindowFeatures;\r\n    popupWindowTarget?: string;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class PopupWindow extends AbstractChildWindow {\r\n    protected readonly _logger = new Logger(\"PopupWindow\");\r\n\r\n    protected _window: WindowProxy | null;\r\n\r\n    public constructor({\r\n        popupWindowTarget = DefaultPopupTarget,\r\n        popupWindowFeatures = {},\r\n    }: PopupWindowParams) {\r\n        super();\r\n        const centeredPopup = PopupUtils.center({ ...DefaultPopupWindowFeatures, ...popupWindowFeatures });\r\n        this._window = window.open(undefined, popupWindowTarget, PopupUtils.serialize(centeredPopup));\r\n    }\r\n\r\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\r\n        this._window?.focus();\r\n\r\n        const popupClosedInterval = setInterval(() => {\r\n            if (!this._window || this._window.closed) {\r\n                this._abort.raise(new Error(\"Popup closed by user\"));\r\n            }\r\n        }, checkForPopupClosedInterval);\r\n        this._disposeHandlers.add(() => clearInterval(popupClosedInterval));\r\n\r\n        return await super.navigate(params);\r\n    }\r\n\r\n    public close(): void {\r\n        if (this._window) {\r\n            if (!this._window.closed) {\r\n                this._window.close();\r\n                this._abort.raise(new Error(\"Popup closed\"));\r\n            }\r\n        }\r\n        this._window = null;\r\n    }\r\n\r\n    public static notifyOpener(url: string, keepOpen: boolean): void {\r\n        if (!window.opener) {\r\n            throw new Error(\"No window.opener. Can't complete notification.\");\r\n        }\r\n        return super._notifyParent(window.opener, url, keepOpen);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"../utils\";\r\nimport { PopupWindow, PopupWindowParams } from \"./PopupWindow\";\r\nimport type { INavigator } from \"./INavigator\";\r\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class PopupNavigator implements INavigator {\r\n    private readonly _logger = new Logger(\"PopupNavigator\");\r\n\r\n    constructor(private _settings: UserManagerSettingsStore) {}\r\n\r\n    public async prepare({\r\n        popupWindowFeatures = this._settings.popupWindowFeatures,\r\n        popupWindowTarget = this._settings.popupWindowTarget,\r\n    }: PopupWindowParams): Promise<PopupWindow> {\r\n        return new PopupWindow({ popupWindowFeatures, popupWindowTarget });\r\n    }\r\n\r\n    public async callback(url: string, keepOpen = false): Promise<void> {\r\n        this._logger.create(\"callback\");\r\n\r\n        PopupWindow.notifyOpener(url, keepOpen);\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"../utils\";\r\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\r\nimport type { INavigator } from \"./INavigator\";\r\nimport type { IWindow } from \"./IWindow\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface RedirectParams {\r\n    redirectMethod?: \"replace\" | \"assign\";\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class RedirectNavigator implements INavigator {\r\n    private readonly _logger = new Logger(\"RedirectNavigator\");\r\n\r\n    constructor(private _settings: UserManagerSettingsStore) {}\r\n\r\n    public async prepare({\r\n        redirectMethod = this._settings.redirectMethod,\r\n    }: RedirectParams): Promise<IWindow> {\r\n        this._logger.create(\"prepare\");\r\n        const redirect = window.location[redirectMethod].bind(window.location) as (url: string) => never;\r\n        let abort: (reason: Error) => void;\r\n        return {\r\n            navigate: async (params): Promise<never> => {\r\n                this._logger.create(\"navigate\");\r\n                const promise = new Promise((resolve, reject) => {\r\n                    abort = reject;\r\n                    window.addEventListener(\"unload\", () => resolve(null));\r\n                });\r\n                redirect(params.url);\r\n                return await (promise as Promise<never>);\r\n            },\r\n            close: () => {\r\n                this._logger.create(\"close\");\r\n                abort?.(new Error(\"Redirect aborted\"));\r\n                window.stop();\r\n            },\r\n        };\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, Event } from \"./utils\";\r\nimport { AccessTokenEvents } from \"./AccessTokenEvents\";\r\nimport type { UserManagerSettingsStore } from \"./UserManagerSettings\";\r\nimport type { User } from \"./User\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport type UserLoadedCallback = (user: User) => Promise<void> | void;\r\n/**\r\n * @public\r\n */\r\nexport type UserUnloadedCallback = () => Promise<void> | void;\r\n/**\r\n * @public\r\n */\r\nexport type SilentRenewErrorCallback = (error: Error) => Promise<void> | void;\r\n/**\r\n * @public\r\n */\r\nexport type UserSignedInCallback = () => Promise<void> | void;\r\n/**\r\n * @public\r\n */\r\nexport type UserSignedOutCallback = () => Promise<void> | void;\r\n/**\r\n * @public\r\n */\r\nexport type UserSessionChangedCallback = () => Promise<void> | void;\r\n\r\n/**\r\n * @public\r\n */\r\nexport class UserManagerEvents extends AccessTokenEvents {\r\n    protected readonly _logger = new Logger(\"UserManagerEvents\");\r\n\r\n    private readonly _userLoaded = new Event<[User]>(\"User loaded\");\r\n    private readonly _userUnloaded = new Event<[]>(\"User unloaded\");\r\n    private readonly _silentRenewError = new Event<[Error]>(\"Silent renew error\");\r\n    private readonly _userSignedIn = new Event<[]>(\"User signed in\");\r\n    private readonly _userSignedOut = new Event<[]>(\"User signed out\");\r\n    private readonly _userSessionChanged = new Event<[]>(\"User session changed\");\r\n\r\n    public constructor(settings: UserManagerSettingsStore) {\r\n        super({ expiringNotificationTimeInSeconds: settings.accessTokenExpiringNotificationTimeInSeconds });\r\n    }\r\n\r\n    public load(user: User, raiseEvent=true): void {\r\n        super.load(user);\r\n        if (raiseEvent) {\r\n            this._userLoaded.raise(user);\r\n        }\r\n    }\r\n    public unload(): void {\r\n        super.unload();\r\n        this._userUnloaded.raise();\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised when a user session has been established (or re-established).\r\n     */\r\n    public addUserLoaded(cb: UserLoadedCallback): () => void {\r\n        return this._userLoaded.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised when a user session has been established (or re-established).\r\n     */\r\n    public removeUserLoaded(cb: UserLoadedCallback): void {\r\n        return this._userLoaded.removeHandler(cb);\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised when a user session has been terminated.\r\n     */\r\n    public addUserUnloaded(cb: UserUnloadedCallback): () => void {\r\n        return this._userUnloaded.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised when a user session has been terminated.\r\n     */\r\n    public removeUserUnloaded(cb: UserUnloadedCallback): void {\r\n        return this._userUnloaded.removeHandler(cb);\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised when the automatic silent renew has failed.\r\n     */\r\n    public addSilentRenewError(cb: SilentRenewErrorCallback): () => void {\r\n        return this._silentRenewError.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised when the automatic silent renew has failed.\r\n     */\r\n    public removeSilentRenewError(cb: SilentRenewErrorCallback): void {\r\n        return this._silentRenewError.removeHandler(cb);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public _raiseSilentRenewError(e: Error): void {\r\n        this._silentRenewError.raise(e);\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised when the user is signed in.\r\n     */\r\n    public addUserSignedIn(cb: UserSignedInCallback): () => void {\r\n        return this._userSignedIn.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised when the user is signed in.\r\n     */\r\n    public removeUserSignedIn(cb: UserSignedInCallback): void {\r\n        this._userSignedIn.removeHandler(cb);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public _raiseUserSignedIn(): void {\r\n        this._userSignedIn.raise();\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised when the user's sign-in status at the OP has changed.\r\n     */\r\n    public addUserSignedOut(cb: UserSignedOutCallback): () => void {\r\n        return this._userSignedOut.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised when the user's sign-in status at the OP has changed.\r\n     */\r\n    public removeUserSignedOut(cb: UserSignedOutCallback): void {\r\n        this._userSignedOut.removeHandler(cb);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public _raiseUserSignedOut(): void {\r\n        this._userSignedOut.raise();\r\n    }\r\n\r\n    /**\r\n     * Add callback: Raised when the user session changed (when `monitorSession` is set)\r\n     */\r\n    public addUserSessionChanged(cb: UserSessionChangedCallback): () => void {\r\n        return this._userSessionChanged.addHandler(cb);\r\n    }\r\n    /**\r\n     * Remove callback: Raised when the user session changed (when `monitorSession` is set)\r\n     */\r\n    public removeUserSessionChanged(cb: UserSessionChangedCallback): void {\r\n        this._userSessionChanged.removeHandler(cb);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public _raiseUserSessionChanged(): void {\r\n        this._userSessionChanged.raise();\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger, Timer } from \"./utils\";\r\nimport { ErrorTimeout } from \"./errors\";\r\nimport type { UserManager } from \"./UserManager\";\r\nimport type { AccessTokenCallback } from \"./AccessTokenEvents\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class SilentRenewService {\r\n    protected _logger = new Logger(\"SilentRenewService\");\r\n    private _isStarted = false;\r\n    private readonly _retryTimer = new Timer(\"Retry Silent Renew\");\r\n\r\n    public constructor(private _userManager: UserManager) {}\r\n\r\n    public async start(): Promise<void> {\r\n        const logger = this._logger.create(\"start\");\r\n        if (!this._isStarted) {\r\n            this._isStarted = true;\r\n            this._userManager.events.addAccessTokenExpiring(this._tokenExpiring);\r\n            this._retryTimer.addHandler(this._tokenExpiring);\r\n\r\n            // this will trigger loading of the user so the expiring events can be initialized\r\n            try {\r\n                await this._userManager.getUser();\r\n                // deliberate nop\r\n            }\r\n            catch (err) {\r\n                // catch to suppress errors since we're in a ctor\r\n                logger.error(\"getUser error\", err);\r\n            }\r\n        }\r\n    }\r\n\r\n    public stop(): void {\r\n        if (this._isStarted) {\r\n            this._retryTimer.cancel();\r\n            this._retryTimer.removeHandler(this._tokenExpiring);\r\n            this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring);\r\n            this._isStarted = false;\r\n        }\r\n    }\r\n\r\n    protected _tokenExpiring: AccessTokenCallback = async () => {\r\n        const logger = this._logger.create(\"_tokenExpiring\");\r\n        try {\r\n            await this._userManager.signinSilent();\r\n            logger.debug(\"silent token renewal successful\");\r\n        }\r\n        catch (err) {\r\n            if (err instanceof ErrorTimeout) {\r\n                // no response from authority server, e.g. IFrame timeout, ...\r\n                logger.warn(\"ErrorTimeout from signinSilent:\", err, \"retry in 5s\");\r\n                this._retryTimer.init(5);\r\n                return;\r\n            }\r\n\r\n            logger.error(\"Error from signinSilent:\", err);\r\n            this._userManager.events._raiseSilentRenewError(err as Error);\r\n        }\r\n    };\r\n}\r\n", "// Copyright (C) AuthTS Contributors\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\n/**\r\n * Fake state store implementation necessary for validating refresh token requests.\r\n *\r\n * @internal\r\n */\r\nexport class RefreshState {\r\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\r\n    public readonly data: unknown | undefined;\r\n\r\n    public readonly refresh_token: string;\r\n    public readonly id_token: string;\r\n    public readonly scope: string;\r\n\r\n    constructor(args: {\r\n        refresh_token: string;\r\n        id_token: string;\r\n        scope: string;\r\n        state?: unknown;\r\n    }) {\r\n        this.refresh_token = args.refresh_token;\r\n        this.id_token = args.id_token;\r\n        this.scope = args.scope;\r\n        this.data = args.state;\r\n    }\r\n}\r\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\r\n\r\nimport { Logger } from \"./utils\";\r\nimport { ErrorResponse } from \"./errors\";\r\nimport { IFrameNavigator, NavigateResponse, PopupNavigator, RedirectNavigator, PopupWindowParams,\r\n    IWindow, IFrameWindowParams, RedirectParams } from \"./navigators\";\r\nimport { OidcClient, CreateSigninRequestArgs, CreateSignoutRequestArgs } from \"./OidcClient\";\r\nimport { UserManagerSettings, UserManagerSettingsStore } from \"./UserManagerSettings\";\r\nimport { User } from \"./User\";\r\nimport { UserManagerEvents } from \"./UserManagerEvents\";\r\nimport { SilentRenewService } from \"./SilentRenewService\";\r\nimport { SessionMonitor } from \"./SessionMonitor\";\r\nimport type { SessionStatus } from \"./SessionStatus\";\r\nimport type { SignoutResponse } from \"./SignoutResponse\";\r\nimport type { MetadataService } from \"./MetadataService\";\r\nimport { RefreshState } from \"./RefreshState\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport type ExtraSigninRequestArgs = Pick<CreateSigninRequestArgs, \"nonce\" | \"extraQueryParams\" | \"extraTokenParams\" | \"state\" | \"redirect_uri\">;\r\n/**\r\n * @public\r\n */\r\nexport type ExtraSignoutRequestArgs = Pick<CreateSignoutRequestArgs, \"extraQueryParams\" | \"state\" | \"id_token_hint\" | \"post_logout_redirect_uri\">;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type RevokeTokensTypes = UserManagerSettings[\"revokeTokenTypes\"];\r\n\r\n/**\r\n * @public\r\n */\r\nexport type SigninRedirectArgs = RedirectParams & ExtraSigninRequestArgs;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type SigninPopupArgs = PopupWindowParams & ExtraSigninRequestArgs;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type SigninSilentArgs = IFrameWindowParams & ExtraSigninRequestArgs;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type QuerySessionStatusArgs = IFrameWindowParams & ExtraSigninRequestArgs;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type SignoutRedirectArgs = RedirectParams & ExtraSignoutRequestArgs;\r\n\r\n/**\r\n * @public\r\n */\r\nexport type SignoutPopupArgs = PopupWindowParams & ExtraSignoutRequestArgs;\r\n\r\n/**\r\n * Provides a higher level API for signing a user in, signing out, managing the user's claims returned from the OIDC provider,\r\n * and managing an access token returned from the OIDC/OAuth2 provider.\r\n *\r\n * @public\r\n */\r\nexport class UserManager {\r\n    /** Returns the settings used to configure the `UserManager`. */\r\n    public readonly settings: UserManagerSettingsStore;\r\n    protected readonly _logger = new Logger(\"UserManager\");\r\n\r\n    protected readonly _client: OidcClient;\r\n    protected readonly _redirectNavigator: RedirectNavigator;\r\n    protected readonly _popupNavigator: PopupNavigator;\r\n    protected readonly _iframeNavigator: IFrameNavigator;\r\n    protected readonly _events: UserManagerEvents;\r\n    protected readonly _silentRenewService: SilentRenewService;\r\n    protected readonly _sessionMonitor: SessionMonitor | null;\r\n\r\n    public constructor(settings: UserManagerSettings) {\r\n        this.settings = new UserManagerSettingsStore(settings);\r\n\r\n        this._client = new OidcClient(settings);\r\n\r\n        this._redirectNavigator = new RedirectNavigator(this.settings);\r\n        this._popupNavigator = new PopupNavigator(this.settings);\r\n        this._iframeNavigator = new IFrameNavigator(this.settings);\r\n\r\n        this._events = new UserManagerEvents(this.settings);\r\n        this._silentRenewService = new SilentRenewService(this);\r\n\r\n        // order is important for the following properties; these services depend upon the events.\r\n        if (this.settings.automaticSilentRenew) {\r\n            this.startSilentRenew();\r\n        }\r\n\r\n        this._sessionMonitor = null;\r\n        if (this.settings.monitorSession) {\r\n            this._sessionMonitor = new SessionMonitor(this);\r\n        }\r\n\r\n    }\r\n\r\n    /** Returns an object used to register for events raised by the `UserManager`. */\r\n    public get events(): UserManagerEvents {\r\n        return this._events;\r\n    }\r\n\r\n    /** Returns an object used to access the metadata configuration of the OIDC provider. */\r\n    public get metadataService(): MetadataService {\r\n        return this._client.metadataService;\r\n    }\r\n\r\n    /**\r\n     * Returns promise to load the `User` object for the currently authenticated user.\r\n     */\r\n    public async getUser(): Promise<User | null> {\r\n        const logger = this._logger.create(\"getUser\");\r\n        const user = await this._loadUser();\r\n        if (user) {\r\n            logger.info(\"user loaded\");\r\n            this._events.load(user, false);\r\n            return user;\r\n        }\r\n\r\n        logger.info(\"user not found in storage\");\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Returns promise to remove from any storage the currently authenticated user.\r\n     */\r\n    public async removeUser(): Promise<void> {\r\n        const logger = this._logger.create(\"removeUser\");\r\n        await this.storeUser(null);\r\n        logger.info(\"user removed from storage\");\r\n        this._events.unload();\r\n    }\r\n\r\n    /**\r\n     * Returns promise to trigger a redirect of the current window to the authorization endpoint.\r\n     */\r\n    public async signinRedirect(args: SigninRedirectArgs = {}): Promise<void> {\r\n        this._logger.create(\"signinRedirect\");\r\n        const {\r\n            redirectMethod,\r\n            ...requestArgs\r\n        } = args;\r\n        const handle = await this._redirectNavigator.prepare({ redirectMethod });\r\n        await this._signinStart({\r\n            request_type: \"si:r\",\r\n            ...requestArgs,\r\n        }, handle);\r\n    }\r\n\r\n    /**\r\n     * Returns promise to process response from the authorization endpoint. The result of the promise is the authenticated `User`.\r\n     */\r\n    public async signinRedirectCallback(url = window.location.href): Promise<User> {\r\n        const logger = this._logger.create(\"signinRedirectCallback\");\r\n        const user = await this._signinEnd(url);\r\n        if (user.profile && user.profile.sub) {\r\n            logger.info(\"success, signed in subject\", user.profile.sub);\r\n        }\r\n        else {\r\n            logger.info(\"no subject\");\r\n        }\r\n\r\n        return user;\r\n    }\r\n\r\n    /**\r\n     * Returns promise to trigger a request (via a popup window) to the authorization endpoint. The result of the promise is the authenticated `User`.\r\n     */\r\n    public async signinPopup(args: SigninPopupArgs = {}): Promise<User> {\r\n        const logger = this._logger.create(\"signinPopup\");\r\n        const {\r\n            popupWindowFeatures,\r\n            popupWindowTarget,\r\n            ...requestArgs\r\n        } = args;\r\n        const url = this.settings.popup_redirect_uri;\r\n        if (!url) {\r\n            logger.throw(new Error(\"No popup_redirect_uri configured\"));\r\n        }\r\n\r\n        const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget });\r\n        const user = await this._signin({\r\n            request_type: \"si:p\",\r\n            redirect_uri: url,\r\n            display: \"popup\",\r\n            ...requestArgs,\r\n        }, handle);\r\n        if (user) {\r\n            if (user.profile && user.profile.sub) {\r\n                logger.info(\"success, signed in subject\", user.profile.sub);\r\n            }\r\n            else {\r\n                logger.info(\"no subject\");\r\n            }\r\n        }\r\n\r\n        return user;\r\n    }\r\n    /**\r\n     * Returns promise to notify the opening window of response from the authorization endpoint.\r\n     */\r\n    public async signinPopupCallback(url = window.location.href, keepOpen = false): Promise<void> {\r\n        const logger = this._logger.create(\"signinPopupCallback\");\r\n        await this._popupNavigator.callback(url, keepOpen);\r\n        logger.info(\"success\");\r\n    }\r\n\r\n    /**\r\n     * Returns promise to trigger a silent request (via an iframe) to the authorization endpoint.\r\n     * The result of the promise is the authenticated `User`.\r\n     */\r\n    public async signinSilent(args: SigninSilentArgs = {}): Promise<User | null> {\r\n        const logger = this._logger.create(\"signinSilent\");\r\n        const {\r\n            silentRequestTimeoutInSeconds,\r\n            ...requestArgs\r\n        } = args;\r\n        // first determine if we have a refresh token, or need to use iframe\r\n        let user = await this._loadUser();\r\n        if (user?.refresh_token) {\r\n            logger.debug(\"using refresh token\");\r\n            const state = new RefreshState(user as Required<User>);\r\n            return await this._useRefreshToken(state, requestArgs);\r\n        }\r\n\r\n        const url = this.settings.silent_redirect_uri;\r\n        if (!url) {\r\n            logger.throw(new Error(\"No silent_redirect_uri configured\"));\r\n        }\r\n\r\n        let verifySub: string | undefined;\r\n        if (user && this.settings.validateSubOnSilentRenew) {\r\n            logger.debug(\"subject prior to silent renew:\", user.profile.sub);\r\n            verifySub = user.profile.sub;\r\n        }\r\n\r\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\r\n        user = await this._signin({\r\n            request_type: \"si:s\",\r\n            redirect_uri: url,\r\n            prompt: \"none\",\r\n            id_token_hint: this.settings.includeIdTokenInSilentRenew ? user?.id_token : undefined,\r\n            ...requestArgs,\r\n        }, handle, verifySub);\r\n        if (user) {\r\n            if (user.profile?.sub) {\r\n                logger.info(\"success, signed in subject\", user.profile.sub);\r\n            }\r\n            else {\r\n                logger.info(\"no subject\");\r\n            }\r\n        }\r\n\r\n        return user;\r\n    }\r\n\r\n    protected async _useRefreshToken(state: RefreshState, customRequestArgs: object = {}): Promise<User> {\r\n        const response = await this._client.useRefreshToken({\r\n            state,\r\n            timeoutInSeconds: this.settings.silentRequestTimeoutInSeconds,\r\n            customRequestArgs,\r\n        });\r\n        const user = new User({ ...state, ...response });\r\n\r\n        await this.storeUser(user);\r\n        this._events.load(user);\r\n        return user;\r\n    }\r\n\r\n    /**\r\n     * Returns promise to notify the parent window of response from the authorization endpoint.\r\n     */\r\n    public async signinSilentCallback(url = window.location.href): Promise<void> {\r\n        const logger = this._logger.create(\"signinSilentCallback\");\r\n        await this._iframeNavigator.callback(url);\r\n        logger.info(\"success\");\r\n    }\r\n\r\n    public async signinCallback(url = window.location.href): Promise<User | void> {\r\n        const { state } = await this._client.readSigninResponseState(url);\r\n        switch (state.request_type) {\r\n            case \"si:r\":\r\n                return await this.signinRedirectCallback(url);\r\n            case \"si:p\":\r\n                return await this.signinPopupCallback(url);\r\n            case \"si:s\":\r\n                return await this.signinSilentCallback(url);\r\n            default:\r\n                throw new Error(\"invalid response_type in state\");\r\n        }\r\n    }\r\n\r\n    public async signoutCallback(url = window.location.href, keepOpen = false): Promise<void> {\r\n        const { state } = await this._client.readSignoutResponseState(url);\r\n        if (!state) {\r\n            return;\r\n        }\r\n\r\n        switch (state.request_type) {\r\n            case \"so:r\":\r\n                await this.signoutRedirectCallback(url);\r\n                break;\r\n            case \"so:p\":\r\n                await this.signoutPopupCallback(url, keepOpen);\r\n                break;\r\n            default:\r\n                throw new Error(\"invalid response_type in state\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns promise to query OP for user's current signin status. Returns object with session_state and subject identifier.\r\n     */\r\n    public async querySessionStatus(args: QuerySessionStatusArgs = {}): Promise<SessionStatus | null> {\r\n        const logger = this._logger.create(\"querySessionStatus\");\r\n        const {\r\n            silentRequestTimeoutInSeconds,\r\n            ...requestArgs\r\n        } = args;\r\n        const url = this.settings.silent_redirect_uri;\r\n        if (!url) {\r\n            logger.throw(new Error(\"No silent_redirect_uri configured\"));\r\n        }\r\n\r\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\r\n        const navResponse = await this._signinStart({\r\n            request_type: \"si:s\", // this acts like a signin silent\r\n            redirect_uri: url,\r\n            prompt: \"none\",\r\n            response_type: this.settings.query_status_response_type,\r\n            scope: \"openid\",\r\n            skipUserInfo: true,\r\n            ...requestArgs,\r\n        }, handle);\r\n        try {\r\n            const signinResponse = await this._client.processSigninResponse(navResponse.url);\r\n            logger.debug(\"got signin response\");\r\n\r\n            if (signinResponse.session_state && signinResponse.profile.sub) {\r\n                logger.info(\"success for subject\", signinResponse.profile.sub);\r\n                return {\r\n                    session_state: signinResponse.session_state,\r\n                    sub: signinResponse.profile.sub,\r\n                    sid: signinResponse.profile.sid,\r\n                };\r\n            }\r\n\r\n            logger.info(\"success, user not authenticated\");\r\n            return null;\r\n        }\r\n        catch (err) {\r\n            if (this.settings.monitorAnonymousSession && err instanceof ErrorResponse) {\r\n                switch (err.error) {\r\n                    case \"login_required\":\r\n                    case \"consent_required\":\r\n                    case \"interaction_required\":\r\n                    case \"account_selection_required\":\r\n                        logger.info(\"success for anonymous user\");\r\n                        return {\r\n                            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                            session_state: err.session_state!,\r\n                        };\r\n                }\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    protected async _signin(args: CreateSigninRequestArgs, handle: IWindow, verifySub?: string): Promise<User> {\r\n        const navResponse = await this._signinStart(args, handle);\r\n        return await this._signinEnd(navResponse.url, verifySub);\r\n    }\r\n    protected async _signinStart(args: CreateSigninRequestArgs, handle: IWindow): Promise<NavigateResponse> {\r\n        const logger = this._logger.create(\"_signinStart\");\r\n\r\n        try {\r\n            const signinRequest = await this._client.createSigninRequest(args);\r\n            logger.debug(\"got signin request\");\r\n\r\n            return await handle.navigate({\r\n                url: signinRequest.url,\r\n                state: signinRequest.state.id,\r\n                response_mode: signinRequest.state.response_mode,\r\n            });\r\n        }\r\n        catch (err) {\r\n            logger.debug(\"error after preparing navigator, closing navigator window\");\r\n            handle.close();\r\n            throw err;\r\n        }\r\n    }\r\n    protected async _signinEnd(url: string, verifySub?: string): Promise<User> {\r\n        const logger = this._logger.create(\"_signinEnd\");\r\n        const signinResponse = await this._client.processSigninResponse(url);\r\n        logger.debug(\"got signin response\");\r\n\r\n        const user = new User(signinResponse);\r\n        if (verifySub) {\r\n            if (verifySub !== user.profile.sub) {\r\n                logger.debug(\"current user does not match user returned from signin. sub from signin:\", user.profile.sub);\r\n                throw new ErrorResponse({ ...signinResponse, error: \"login_required\" });\r\n            }\r\n            logger.debug(\"current user matches user returned from signin\");\r\n        }\r\n\r\n        await this.storeUser(user);\r\n        logger.debug(\"user stored\");\r\n        this._events.load(user);\r\n\r\n        return user;\r\n    }\r\n\r\n    /**\r\n     * Returns promise to trigger a redirect of the current window to the end session endpoint.\r\n     */\r\n    public async signoutRedirect(args: SignoutRedirectArgs = {}): Promise<void> {\r\n        const logger = this._logger.create(\"signoutRedirect\");\r\n        const {\r\n            redirectMethod,\r\n            ...requestArgs\r\n        } = args;\r\n        const handle = await this._redirectNavigator.prepare({ redirectMethod });\r\n        await this._signoutStart({\r\n            request_type: \"so:r\",\r\n            post_logout_redirect_uri: this.settings.post_logout_redirect_uri,\r\n            ...requestArgs,\r\n        }, handle);\r\n        logger.info(\"success\");\r\n    }\r\n\r\n    /**\r\n     * Returns promise to process response from the end session endpoint.\r\n     */\r\n    public async signoutRedirectCallback(url = window.location.href): Promise<SignoutResponse> {\r\n        const logger = this._logger.create(\"signoutRedirectCallback\");\r\n        const response = await this._signoutEnd(url);\r\n        logger.info(\"success\");\r\n        return response;\r\n    }\r\n\r\n    /**\r\n     * Returns promise to trigger a redirect of a popup window window to the end session endpoint.\r\n     */\r\n    public async signoutPopup(args: SignoutPopupArgs = {}): Promise<void> {\r\n        const logger = this._logger.create(\"signoutPopup\");\r\n        const {\r\n            popupWindowFeatures,\r\n            popupWindowTarget,\r\n            ...requestArgs\r\n        } = args;\r\n        const url = this.settings.popup_post_logout_redirect_uri;\r\n\r\n        const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget });\r\n        await this._signout({\r\n            request_type: \"so:p\",\r\n            post_logout_redirect_uri: url,\r\n            // we're putting a dummy entry in here because we\r\n            // need a unique id from the state for notification\r\n            // to the parent window, which is necessary if we\r\n            // plan to return back to the client after signout\r\n            // and so we can close the popup after signout\r\n            state: url == null ? undefined : {},\r\n            ...requestArgs,\r\n        }, handle);\r\n        logger.info(\"success\");\r\n    }\r\n\r\n    /**\r\n     * Returns promise to process response from the end session endpoint from a popup window.\r\n     */\r\n    public async signoutPopupCallback(url = window.location.href, keepOpen = false): Promise<void> {\r\n        const logger = this._logger.create(\"signoutPopupCallback\");\r\n        await this._popupNavigator.callback(url, keepOpen);\r\n        logger.info(\"success\");\r\n    }\r\n\r\n    protected async _signout(args: CreateSignoutRequestArgs, handle: IWindow): Promise<SignoutResponse> {\r\n        const navResponse = await this._signoutStart(args, handle);\r\n        return await this._signoutEnd(navResponse.url);\r\n    }\r\n    protected async _signoutStart(args: CreateSignoutRequestArgs = {}, handle: IWindow): Promise<NavigateResponse> {\r\n        const logger = this._logger.create(\"_signoutStart\");\r\n\r\n        try {\r\n            const user = await this._loadUser();\r\n            logger.debug(\"loaded current user from storage\");\r\n\r\n            if (this.settings.revokeTokensOnSignout) {\r\n                await this._revokeInternal(user);\r\n            }\r\n\r\n            const id_token = args.id_token_hint || user && user.id_token;\r\n            if (id_token) {\r\n                logger.debug(\"setting id_token_hint in signout request\");\r\n                args.id_token_hint = id_token;\r\n            }\r\n\r\n            await this.removeUser();\r\n            logger.debug(\"user removed, creating signout request\");\r\n\r\n            const signoutRequest = await this._client.createSignoutRequest(args);\r\n            logger.debug(\"got signout request\");\r\n\r\n            return await handle.navigate({\r\n                url: signoutRequest.url,\r\n                state: signoutRequest.state?.id,\r\n            });\r\n        }\r\n        catch (err) {\r\n            logger.debug(\"error after preparing navigator, closing navigator window\");\r\n            handle.close();\r\n            throw err;\r\n        }\r\n    }\r\n    protected async _signoutEnd(url: string): Promise<SignoutResponse> {\r\n        const logger = this._logger.create(\"_signoutEnd\");\r\n        const signoutResponse = await this._client.processSignoutResponse(url);\r\n        logger.debug(\"got signout response\");\r\n\r\n        return signoutResponse;\r\n    }\r\n\r\n    public async revokeTokens(types?: RevokeTokensTypes): Promise<void> {\r\n        const user = await this._loadUser();\r\n        await this._revokeInternal(user, types);\r\n    }\r\n\r\n    protected async _revokeInternal(user: User | null, types = this.settings.revokeTokenTypes): Promise<void> {\r\n        const logger = this._logger.create(\"_revokeInternal\");\r\n        if (!user) return;\r\n\r\n        const typesPresent = types.filter(type => typeof user[type] === \"string\");\r\n\r\n        if (!typesPresent.length) {\r\n            logger.debug(\"no need to revoke due to no token(s)\");\r\n            return;\r\n        }\r\n\r\n        // don't Promise.all, order matters\r\n        for (const type of typesPresent) {\r\n            await this._client.revokeToken(\r\n                user[type]!, // eslint-disable-line @typescript-eslint/no-non-null-assertion\r\n                type,\r\n            );\r\n            logger.info(`${type} revoked successfully`);\r\n            if (type !== \"access_token\") {\r\n                user[type] = null as never;\r\n            }\r\n        }\r\n\r\n        await this.storeUser(user);\r\n        logger.debug(\"user stored\");\r\n        this._events.load(user);\r\n    }\r\n\r\n    /**\r\n     * Enables silent renew for the `UserManager`.\r\n     */\r\n    public startSilentRenew(): void {\r\n        this._logger.create(\"startSilentRenew\");\r\n        void this._silentRenewService.start();\r\n    }\r\n\r\n    /**\r\n     * Disables silent renew for the `UserManager`.\r\n     */\r\n    public stopSilentRenew(): void {\r\n        this._silentRenewService.stop();\r\n    }\r\n\r\n    protected get _userStoreKey(): string {\r\n        return `user:${this.settings.authority}:${this.settings.client_id}`;\r\n    }\r\n\r\n    protected async _loadUser(): Promise<User | null> {\r\n        const logger = this._logger.create(\"_loadUser\");\r\n        const storageString = await this.settings.userStore.get(this._userStoreKey);\r\n        if (storageString) {\r\n            logger.debug(\"user storageString loaded\");\r\n            return User.fromStorageString(storageString);\r\n        }\r\n\r\n        logger.debug(\"no user storageString\");\r\n        return null;\r\n    }\r\n\r\n    public async storeUser(user: User | null): Promise<void> {\r\n        const logger = this._logger.create(\"storeUser\");\r\n        if (user) {\r\n            logger.debug(\"storing user\");\r\n            const storageString = user.toStorageString();\r\n            await this.settings.userStore.set(this._userStoreKey, storageString);\r\n        }\r\n        else {\r\n            this._logger.debug(\"removing user\");\r\n            await this.settings.userStore.remove(this._userStoreKey);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes stale state entries in storage for incomplete authorize requests.\r\n     */\r\n    public async clearStaleState(): Promise<void> {\r\n        await this._client.clearStaleState();\r\n    }\r\n}\r\n", "// @ts-expect-error avoid enabling resolveJsonModule to keep build process simple\r\nimport { version } from \"../package.json\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport const Version: string = version;\r\n"],
  "mappings": "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",
  "names": []
}
